All tasks complete. Here's a summary of all changes:

## Changes Made

### Track A: Staging infra
- **`.github/workflows/deploy-staging.yml`** — Changed `NODE_ENV=production` to `NODE_ENV=staging` and added `TEST_LOGIN_SECRET=${{ secrets.STAGING_TEST_LOGIN_SECRET }}` to the generated env file. This unblocks test-login on the staging API.

### Track B: Desktop test-mode fixes

1. **`apps/desktop/src-tauri/src/commands.rs`** — Extracted the shared post-auth logic (token storage, vault init/fetch, device registration, FUSE mount, window management) into a new `complete_auth_setup()` helper. `handle_auth_complete` now delegates to it after the `/auth/login` POST.

2. **`apps/desktop/src-tauri/src/commands.rs`** — Added `handle_test_login_complete` (gated by `#[cfg(debug_assertions)]`) that accepts `{ access_token, refresh_token, private_key_hex, is_new_user }` from the webview and calls `complete_auth_setup` directly, skipping the `/auth/login` POST.

3. **`apps/desktop/src-tauri/src/main.rs`** — cfg-gated the invoke handler list to include `handle_test_login_complete` only in debug builds.

4. **`apps/desktop/src/main.ts`** — Fixed all three bugs in `handleDevKeyAuth`:
   - Uses `data.accessToken` (not `data.idToken`)
   - Uses `data.privateKeyHex` from test-login response (not the CLI dev key)
   - Calls `handle_test_login_complete` (not `handle_auth_complete`)
   - Throws immediately when `VITE_TEST_LOGIN_SECRET` is missing

5. **`apps/desktop/.env`** — Added `VITE_TEST_LOGIN_SECRET=e2e-test-secret-do-not-use-in-production`

6. **`apps/desktop/CLAUDE.md`** — Updated dev-key mode docs to reflect the fixed behavior.

### Verification
- `cargo build` (debug) — compiles with new command
- `cargo build --release` — `handle_test_login_complete` is correctly excluded

### Next steps
- Add `STAGING_TEST_LOGIN_SECRET` secret to the GitHub staging environment
- Deploy to staging to enable test-login there