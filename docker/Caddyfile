# CipherBox Staging - Caddy Reverse Proxy & Web App
# Cloudflare Origin CA certificates for Full (Strict) SSL mode
# Cloudflare handles browser-facing TLS; Caddy handles CF-to-origin TLS

{
	auto_https off
}

api-staging.cipherbox.cc {
	tls /etc/caddy/certs/origin.pem /etc/caddy/certs/origin-key.pem
	respond /metrics 403
	reverse_proxy api:3000
}

app-staging.cipherbox.cc {
	tls /etc/caddy/certs/origin.pem /etc/caddy/certs/origin-key.pem
	root * /srv/web
	try_files {path} /index.html
	file_server
}

:80 {
	redir https://{host}{uri} permanent
}
