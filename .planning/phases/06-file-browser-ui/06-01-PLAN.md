---
phase: 06-file-browser-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/routes/Login.tsx
  - apps/web/src/routes/Dashboard.tsx
  - apps/web/src/components/file-browser/FileBrowser.tsx
  - apps/web/src/components/file-browser/FolderTree.tsx
  - apps/web/src/components/file-browser/FolderTreeNode.tsx
  - apps/web/src/components/file-browser/FileList.tsx
  - apps/web/src/components/file-browser/FileListItem.tsx
  - apps/web/src/components/file-browser/EmptyState.tsx
  - apps/web/src/components/file-browser/index.ts
  - apps/web/src/hooks/useFolderNavigation.ts
  - apps/web/src/styles/file-browser.css
  - apps/web/src/App.css
autonomous: true

must_haves:
  truths:
    - "User sees login page with Web3Auth modal on first visit"
    - "User sees file browser with folder tree sidebar after login"
    - "User can click folders in sidebar to navigate"
    - "User sees files and folders in list view with name, size, date columns"
    - "Folders sorted first, then files, both alphabetically"
  artifacts:
    - path: "apps/web/src/components/file-browser/FileBrowser.tsx"
      provides: "Main container component orchestrating sidebar and file list"
      min_lines: 50
    - path: "apps/web/src/components/file-browser/FolderTree.tsx"
      provides: "Sidebar folder tree navigation"
      exports: ["FolderTree"]
    - path: "apps/web/src/components/file-browser/FileList.tsx"
      provides: "File/folder list display with columns"
      exports: ["FileList"]
    - path: "apps/web/src/hooks/useFolderNavigation.ts"
      provides: "Navigation state and folder loading logic"
      exports: ["useFolderNavigation"]
  key_links:
    - from: "apps/web/src/routes/Dashboard.tsx"
      to: "FileBrowser component"
      via: "import and render"
      pattern: "import.*FileBrowser"
    - from: "apps/web/src/components/file-browser/FolderTree.tsx"
      to: "useFolderStore"
      via: "Zustand subscription"
      pattern: "useFolderStore"
    - from: "apps/web/src/components/file-browser/FileList.tsx"
      to: "FolderChild type"
      via: "type import"
      pattern: "FolderChild"
---

<objective>
Build the core file browser layout with folder tree sidebar and file list display.

Purpose: Provides the foundational UI structure for file management (WEB-01, WEB-02). Users need to see their vault contents organized in a familiar file manager interface with navigable folder hierarchy.

Output: Working file browser with sidebar navigation, file list with columns, and folder loading on navigation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-file-browser-ui/06-CONTEXT.md
@.planning/phases/06-file-browser-ui/06-RESEARCH.md

# Existing infrastructure
@apps/web/src/stores/folder.store.ts
@apps/web/src/stores/vault.store.ts
@apps/web/src/hooks/useFolder.ts
@apps/web/src/routes/Dashboard.tsx
@apps/web/src/routes/Login.tsx
@apps/web/src/App.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create folder navigation hook and tree components</name>
  <files>
    apps/web/src/hooks/useFolderNavigation.ts
    apps/web/src/components/file-browser/FolderTree.tsx
    apps/web/src/components/file-browser/FolderTreeNode.tsx
  </files>
  <action>
Create useFolderNavigation hook that manages:
- currentFolderId state (string | null, null = root)
- breadcrumbs array derived from folder hierarchy
- navigateTo(folderId) function that updates current folder
- loadFolder(folderId) function that fetches folder metadata from IPNS if not loaded
- Use useFolderStore for folder state, useVaultStore for root folder keys
- On navigation, check if folder.isLoaded; if false, set isLoading and fetch via ipns.service.ts resolveIpnsName

Create FolderTree component:
- Props: onNavigate(folderId), currentFolderId, onDrop (for move operations, placeholder for now)
- Renders FolderTreeNode for root folder from vault store
- Uses folder store to get folder children

Create FolderTreeNode component:
- Props: folderId, level, currentFolderId, onNavigate, onDrop
- Recursive rendering of subfolder tree
- Expand/collapse toggle for folders with children (root expanded by default)
- Visual indicator for active (current) folder
- Indent based on level (16px per level)
- Drop zone styling for drag-drop moves (implement drop handler, drag source in Plan 03)

Per CONTEXT.md: Sidebar auto-collapses on mobile - add CSS classes for mobile overlay mode.
  </action>
  <verify>
TypeScript compiles: `pnpm exec tsc --noEmit`
Lint passes: `pnpm lint`
  </verify>
  <done>
FolderTree renders recursive folder hierarchy from store.
Clicking a folder calls onNavigate.
Current folder visually highlighted.
Folders with children show expand/collapse toggle.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create file list components and empty state</name>
  <files>
    apps/web/src/components/file-browser/FileList.tsx
    apps/web/src/components/file-browser/FileListItem.tsx
    apps/web/src/components/file-browser/EmptyState.tsx
  </files>
  <action>
Create FileList component:
- Props: items (FolderChild[]), selectedId, onSelect, onNavigate, onContextMenu, onDragStart
- Header row with columns: Name, Size, Modified
- Sort items: folders first (type === 'folder'), then alphabetically by name (localeCompare)
- Map over sorted items rendering FileListItem
- Use CSS Grid for column layout (name flex-grow, size 100px, date 150px)

Create FileListItem component:
- Props: item (FolderChild), isSelected, onSelect, onNavigate, onContextMenu, onDragStart
- Renders row with icon (folder/file), name, size (formatBytes for files, '-' for folders), date (formatDate)
- onClick: if folder, call onNavigate(item.id); always call onSelect(item.id)
- onContextMenu: call onContextMenu(event, item) (handler in parent)
- draggable="true", onDragStart: serialize {id, type, parentId} to dataTransfer
- Selected state: highlighted background

Create formatBytes and formatDate utility functions in a new utils/format.ts file:
- formatBytes(bytes: number): string - returns "1.2 MB", "456 KB", etc.
- formatDate(timestamp: number): string - uses Intl.DateTimeFormat for locale-aware date

Create EmptyState component:
- Props: onUploadClick (optional, for click-to-upload)
- Large centered content with upload icon, "Drag files here or click to upload" text
- Styled as a drop zone (dashed border)
- Per CONTEXT.md: This is the empty folder drop zone

Create index.ts barrel export for file-browser components.
  </action>
  <verify>
TypeScript compiles: `pnpm exec tsc --noEmit`
Lint passes: `pnpm lint`
  </verify>
  <done>
FileList renders sorted items (folders first, then files alphabetically).
FileListItem shows icon, name, size, date columns.
Double-click folder navigates into it.
Right-click triggers context menu handler.
EmptyState shows upload prompt when folder is empty.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create FileBrowser container and integrate into Dashboard</name>
  <files>
    apps/web/src/components/file-browser/FileBrowser.tsx
    apps/web/src/routes/Dashboard.tsx
    apps/web/src/routes/Login.tsx
    apps/web/src/styles/file-browser.css
    apps/web/src/App.css
  </files>
  <action>
Create FileBrowser container component:
- Uses useFolderNavigation hook for navigation state
- Uses useFolderStore to get current folder's children
- Single selection state: selectedItemId (string | null)
- Clear selection on folder navigation
- Placeholder handlers for context menu (console.log for now, Plan 03)
- Layout: sidebar (FolderTree) + main area (FileList or EmptyState if no children)
- Loading state: show skeleton/spinner when currentFolder.isLoading

Update Dashboard.tsx:
- Replace placeholder content with FileBrowser component
- Keep header with user info and logout button
- Import FileBrowser and render in main area

Update Login.tsx:
- Verify Web3Auth modal trigger works (WEB-01 already implemented in Phase 2)
- Add any missing polish (tagline, description are already present)

Create file-browser.css with styles:
- .file-browser - flex container, full height
- .file-browser-sidebar - 250px width, border-right, overflow auto
- .file-browser-main - flex-grow, overflow auto
- .folder-tree-* - tree styling (indent, icons, active state)
- .file-list-* - list styling (header, rows, columns, selected state)
- .empty-state-* - centered content, dashed border

Update App.css:
- Add any dashboard layout adjustments needed
- Import file-browser.css via @import or ensure it's loaded

Per CONTEXT.md: Use plain CSS (project doesn't use Tailwind yet), namespace all classes with component prefix.
  </action>
  <verify>
`pnpm dev` in apps/web starts dev server
Navigate to / - login page displays with Sign In button
Click Sign In - Web3Auth modal opens
After login - Dashboard shows FileBrowser with sidebar and file list
Click folder in sidebar - navigates and shows folder contents
TypeScript compiles: `pnpm exec tsc --noEmit`
Lint passes: `pnpm lint`
  </verify>
  <done>
Login page shows Web3Auth modal on Sign In click (WEB-01).
Dashboard renders FileBrowser with folder tree sidebar (WEB-02 partial).
File list displays files and folders with name, size, date.
Clicking sidebar folders navigates to that folder.
Empty folders show EmptyState drop zone prompt.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors: `pnpm exec tsc --noEmit`
2. Lint passes: `pnpm lint`
3. Dev server runs: `cd apps/web && pnpm dev`
4. Login page displays Web3Auth modal on click
5. After auth, Dashboard shows file browser with sidebar
6. Folder navigation works via sidebar clicks
</verification>

<success_criteria>
- WEB-01: Login page with Web3Auth modal works (already implemented, verified)
- WEB-02 (partial): File browser with folder tree sidebar displays
- Folder tree shows root folder and subfolders
- File list shows files with name, size, date columns
- Navigation updates current folder and file list
- Empty state shows upload prompt
</success_criteria>

<output>
After completion, create `.planning/phases/06-file-browser-ui/06-01-SUMMARY.md`
</output>
