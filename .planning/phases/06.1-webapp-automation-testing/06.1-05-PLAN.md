---
phase: 06.1-webapp-automation-testing
plan: 05
type: execute
wave: 2
depends_on: ['06.1-01', '06.1-02']
files_modified:
  - tests/e2e/tests/folders/create.spec.ts
  - tests/e2e/tests/folders/rename.spec.ts
  - tests/e2e/tests/folders/delete.spec.ts
  - tests/e2e/tests/folders/navigation.spec.ts
autonomous: true

must_haves:
  truths:
    - 'Create folder test verifies new folder appears in tree and list'
    - 'Rename folder test verifies name change propagates'
    - 'Delete folder test verifies recursive deletion with warning'
    - 'Navigation test verifies breadcrumbs and folder tree sync'
  artifacts:
    - path: 'tests/e2e/tests/folders/create.spec.ts'
      provides: 'Folder creation E2E tests'
      contains: 'test.*create'
    - path: 'tests/e2e/tests/folders/rename.spec.ts'
      provides: 'Folder rename E2E tests'
      contains: 'test.*rename'
    - path: 'tests/e2e/tests/folders/delete.spec.ts'
      provides: 'Folder delete E2E tests'
      contains: 'test.*delete'
    - path: 'tests/e2e/tests/folders/navigation.spec.ts'
      provides: 'Folder navigation E2E tests'
      contains: 'test.*navigation|breadcrumb'
  key_links:
    - from: 'tests/e2e/tests/folders/create.spec.ts'
      to: 'tests/e2e/page-objects/file-browser/folder-tree.page.ts'
      via: 'verifies folder appears in tree'
      pattern: 'folderTree.*folder'
    - from: 'tests/e2e/tests/folders/navigation.spec.ts'
      to: 'apps/web/src/components/file-browser/Breadcrumbs.tsx'
      via: 'tests breadcrumb navigation'
      pattern: 'breadcrumb'
---

<objective>
Create E2E tests for folder operations.

Purpose: Validate complete folder lifecycle including creation, renaming, deletion (with recursive warning), and navigation via breadcrumbs and folder tree. These tests ensure the folder hierarchy system works correctly.

Output:

- Create folder test suite
- Rename folder test suite via context menu
- Delete folder test suite with recursive deletion warning
- Navigation test suite covering breadcrumbs and folder tree
  </objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.1-webapp-automation-testing/06.1-CONTEXT.md
@.planning/phases/06.1-webapp-automation-testing/06.1-RESEARCH.md
@.planning/phases/06.1-webapp-automation-testing/06.1-01-SUMMARY.md
@.planning/phases/06.1-webapp-automation-testing/06.1-02-SUMMARY.md
@apps/web/src/components/file-browser/FolderTree.tsx
@apps/web/src/components/file-browser/Breadcrumbs.tsx
@apps/web/src/hooks/useFolder.ts
@apps/web/src/hooks/useFolderNavigation.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create folder creation tests</name>
  <files>
    tests/e2e/tests/folders/create.spec.ts
  </files>
  <action>
    1. Create tests/e2e/tests/folders/create.spec.ts:

       Import authenticatedTest and page objects: FileListPage, FolderTreePage
       Import faker for random folder names

       test.describe('Folder Creation'):

       test.beforeEach:
       - Ensure user is authenticated
       - Ideally start with clean vault (empty root folder)

       Tests:
       a) "can create a new folder":
          - Look for "New Folder" button or menu option
          - Click create folder action
          - Assert folder creation dialog/input appears
          - Enter folder name
          - Confirm creation
          - Assert new folder appears in file list
          - Assert new folder appears in folder tree sidebar

       b) "new folder appears in correct location":
          - Navigate into an existing folder (if any) or root
          - Create a new folder
          - Assert folder appears in current folder's contents
          - Assert folder appears as child in tree (under current folder)

       c) "folder creation validates name":
          - Open create folder dialog
          - Try to submit with empty name
          - Assert validation error or disabled button
          - Try name with invalid characters (if any restrictions)

       d) "can create nested folders":
          - Create folder A
          - Navigate into folder A
          - Create folder B inside A
          - Assert folder B appears in A's contents
          - Assert tree shows A > B hierarchy

       e) "new folder is selected after creation":
          - Create a new folder
          - Assert the new folder is selected/highlighted
          - (Depends on UI behavior)

       f) "can create folder via context menu" (if right-click supports this):
          - Right-click in empty area of file list
          - Assert "New Folder" option in context menu (if exists)
          - Click new folder option
          - Complete folder creation

       Note: Find the actual UI trigger for folder creation by examining
       the Dashboard/FileBrowser components. It might be:
       - A toolbar button
       - A context menu option
       - A keyboard shortcut

  </action>
  <verify>
    pnpm --filter @cipherbox/e2e test tests/folders/create.spec.ts
  </verify>
  <done>
    Folder creation tests implemented covering basic creation, nested folders, and tree synchronization.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create folder rename and delete tests</name>
  <files>
    tests/e2e/tests/folders/rename.spec.ts
    tests/e2e/tests/folders/delete.spec.ts
  </files>
  <action>
    1. Create tests/e2e/tests/folders/rename.spec.ts:

       Import authenticatedTest and page objects

       test.describe('Folder Rename'):

       test.beforeEach:
       - Create a test folder to rename

       Tests:
       a) "can rename folder via context menu":
          - Right-click on folder in file list
          - Click rename option
          - Assert rename dialog opens with current name
          - Enter new name
          - Click save
          - Assert folder shows new name in file list
          - Assert folder shows new name in tree sidebar

       b) "renamed folder maintains its contents":
          - Create folder with a file inside
          - Rename the folder
          - Navigate into renamed folder
          - Assert contents (file) are still there

       c) "can cancel folder rename":
          - Open rename dialog
          - Enter new name
          - Click cancel
          - Assert folder still has original name

       d) "folder rename updates breadcrumb if inside folder":
          - Navigate into folder A
          - Rename folder A (from parent or tree)
          - Assert breadcrumb updates to show new name

    2. Create tests/e2e/tests/folders/delete.spec.ts:

       Import authenticatedTest and page objects

       test.describe('Folder Delete'):

       test.beforeEach:
       - Create test folder(s)

       Tests:
       a) "delete empty folder via context menu":
          - Create empty folder
          - Right-click on folder
          - Click delete option
          - Assert confirmation dialog appears
          - Confirm delete
          - Assert folder removed from list
          - Assert folder removed from tree

       b) "delete folder with contents shows warning":
          - Create folder with files/subfolders inside
          - Right-click and delete
          - Assert confirmation warns about recursive deletion
          - Assert message mentions contents will be deleted
          - Confirm delete
          - Assert folder and all contents removed

       c) "can cancel folder delete":
          - Open delete confirmation
          - Click cancel
          - Assert folder still exists

       d) "deleting parent folder removes from child view":
          - Create folder A with subfolder B
          - Navigate into A
          - Delete A from tree sidebar (if possible)
          - Assert navigated out of deleted folder
          - Assert A no longer in root

       e) "deleted folder stays deleted after refresh":
          - Delete a folder
          - Reload page
          - Assert folder is still gone

       Note: Per CONTEXT.md, folder delete always confirms with modal dialog
       and includes warning about contents.

  </action>
  <verify>
    pnpm --filter @cipherbox/e2e test tests/folders/rename.spec.ts tests/folders/delete.spec.ts
  </verify>
  <done>
    Folder rename and delete tests implemented. Rename tests verify tree sync. Delete tests verify recursive deletion warning and content removal.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create folder navigation tests</name>
  <files>
    tests/e2e/tests/folders/navigation.spec.ts
    tests/e2e/page-objects/file-browser/breadcrumbs.page.ts
  </files>
  <action>
    1. Create tests/e2e/page-objects/file-browser/breadcrumbs.page.ts:
       - BreadcrumbsPage class:
         - constructor(page: Page)
         - Locators:
           - container(): breadcrumbs container
           - items(): individual breadcrumb items
           - homeItem(): root/home breadcrumb
         - Methods:
           - getCurrentPath(): Promise<string[]> - get array of folder names in path
           - clickBreadcrumb(name: string): Promise<void> - navigate to folder
           - clickHome(): Promise<void> - navigate to root
           - isVisible(): Promise<boolean>

    2. Update page-objects/file-browser/index.ts to export BreadcrumbsPage

    3. Create tests/e2e/tests/folders/navigation.spec.ts:

       Import authenticatedTest and page objects including BreadcrumbsPage

       test.describe('Folder Navigation'):

       test.beforeEach:
       - Create folder hierarchy: Root > FolderA > FolderB > FolderC

       Tests:
       a) "double-click folder navigates into it":
          - Double-click on FolderA in file list
          - Assert now viewing FolderA contents
          - Assert breadcrumbs show [Root, FolderA]
          - Assert tree shows FolderA selected/expanded

       b) "clicking folder in tree navigates to it":
          - Click FolderB in tree sidebar
          - Assert file list shows FolderB contents
          - Assert breadcrumbs update

       c) "breadcrumb click navigates to parent":
          - Navigate to FolderC (deep in hierarchy)
          - Assert breadcrumbs show full path
          - Click on FolderA in breadcrumbs
          - Assert now viewing FolderA contents
          - Assert FolderB visible in file list

       d) "home/root breadcrumb navigates to root":
          - Navigate deep into folders
          - Click home/root breadcrumb (first item)
          - Assert now at root
          - Assert seeing root folders

       e) "folder tree and file list stay synchronized":
          - Click folder in tree
          - Assert file list updates
          - Double-click subfolder in file list
          - Assert tree selection updates

       f) "back navigation works" (if browser back button is supported):
          - Navigate: Root -> A -> B
          - Press browser back
          - Assert now in A
          - Press back again
          - Assert now in Root

       g) "deep navigation up to 20 levels" (per FOLD-03):
          - This test might be slow - consider skip or reduce depth
          - Create nested folders up to limit
          - Navigate to deepest
          - Assert breadcrumbs show full path
          - Navigate back up via breadcrumbs

  </action>
  <verify>
    pnpm --filter @cipherbox/e2e test tests/folders/navigation.spec.ts
  </verify>
  <done>
    Folder navigation tests implemented covering breadcrumbs, tree clicks, double-click navigation, and synchronization between tree and file list.
  </done>
</task>

</tasks>

<verification>
1. pnpm --filter @cipherbox/e2e test tests/folders/ runs all folder tests
2. Create tests verify folder appears in both list and tree
3. Rename tests verify name propagates to tree and contents preserved
4. Delete tests verify recursive deletion warning and removal
5. Navigation tests verify breadcrumbs, tree, and file list sync
</verification>

<success_criteria>

- Folder creation adds folder to both file list and tree
- Nested folder creation works correctly
- Folder rename updates name in all views (list, tree, breadcrumbs)
- Folder delete shows recursive warning and removes all contents
- Double-click folder navigates into it
- Tree click navigates to folder
- Breadcrumb click navigates to parent folder
- Tree selection stays synchronized with current folder view
  </success_criteria>

<output>
After completion, create `.planning/phases/06.1-webapp-automation-testing/06.1-05-SUMMARY.md`
</output>
