---
phase: 06.3-ui-structure-refactor
plan: 05
type: execute
wave: 3
depends_on: ['06.3-04']
files_modified:
  - apps/web/src/components/file-browser/FileBrowser.tsx
  - apps/web/src/styles/file-browser.css
  - apps/web/src/styles/layout.css
autonomous: false

must_haves:
  truths:
    - 'App shell layout matches Pencil design mockup'
    - 'Header, sidebar, footer are fixed; only content scrolls'
    - 'User menu dropdown opens on hover'
    - 'Storage quota displays in sidebar'
    - 'Status indicator shows in footer'
    - 'File operations (upload, download, rename, delete, move) all work'
    - 'Mobile responsive layout is functional'
  artifacts:
    - path: 'apps/web/src/styles/layout.css'
      provides: 'Final layout styles'
      contains: 'grid-template-areas'
  key_links:
    - from: 'FilesPage'
      to: 'AppShell -> AppHeader/AppSidebar/AppFooter'
      via: 'component tree'
      pattern: 'AppShell'
---

<objective>
Visual verification and final adjustments to ensure UI matches design.

Purpose: Verify the complete UI restructure matches the Pencil design mockup, test all file operations work correctly with the new layout, and make any final style adjustments needed.

Output: Verified working UI that matches design specifications, with any necessary style fixes applied.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06.3-ui-structure-refactor/06.3-CONTEXT.md
@.planning/phases/06.3-ui-structure-refactor/06.3-RESEARCH.md
@.planning/phases/06.3-ui-structure-refactor/06.3-01-SUMMARY.md
@.planning/phases/06.3-ui-structure-refactor/06.3-02-SUMMARY.md
@.planning/phases/06.3-ui-structure-refactor/06.3-03-SUMMARY.md
@.planning/phases/06.3-ui-structure-refactor/06.3-04-SUMMARY.md
@designs/cipher-box-design.pen
</context>

<tasks>

<task type="auto">
  <name>Task 1: Run Application and Test Core Functionality</name>
  <files>
    apps/web/src/components/file-browser/FileBrowser.tsx
  </files>
  <action>
Start the development server and verify core functionality.

**Build and run:**

```bash
pnpm --filter web dev
```

**Automated verification steps:**

1. Build completes without errors
2. Server starts on <http://localhost:5173>

**Prepare for manual verification:**

- Note any TypeScript or runtime errors in console
- Document any obvious layout issues visible in terminal output
- If build fails, fix issues before proceeding to checkpoint

**Common issues to check for:**

- Import errors (missing exports)
- TypeScript type mismatches
- CSS file not found errors
- React component render errors
  </action>
  <verify>
  Run `pnpm --filter web build` - must complete without errors.
  Run `pnpm --filter web dev` - server must start successfully.
  </verify>
  <done>
  Development server runs without build or runtime errors. Application is ready for visual verification.
  </done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete UI restructure with:
- Fixed AppShell layout (header, sidebar, footer)
- New routing (/files, /files/:folderId, /settings)
- In-place folder navigation with [..] PARENT_DIR row
- Updated file list (3 columns: Name, Size, Modified)
- Path-format breadcrumbs (~/root/path)
- User menu dropdown in header
- Storage quota in sidebar
- Status indicator in footer
  </what-built>
  <how-to-verify>
**Prerequisites:**
1. Start the dev server: `pnpm --filter web dev`
2. Start the API server: `pnpm --filter api dev` (or ensure Docker is running)
3. Open browser to http://localhost:5173

**Login and Layout Verification:**

1. Login page appears
2. Login with Web3Auth
3. After login, verify AppShell layout:
   - [ ] Header at top with "> CIPHERBOX" logo on left
   - [ ] User email and dropdown on right in header
   - [ ] Sidebar on left with "Files" and "Settings" nav items
   - [ ] Storage quota bar at bottom of sidebar
   - [ ] Footer at bottom with copyright, links, status indicator
   - [ ] Status shows green dot with "[CONNECTED]"
   - [ ] Only the main content area scrolls (if content overflows)

**User Menu Test:** 4. Hover over user email in header

- [ ] Dropdown appears with [settings] and [logout]

5. Click [settings]
   - [ ] Navigates to /settings page
   - [ ] Settings page is wrapped in same AppShell
6. Click "Files" in sidebar
   - [ ] Returns to /files

**Folder Navigation Test:** 7. On /files page (root folder):

- [ ] No [..] PARENT_DIR row visible
- [ ] Column headers show [NAME] [SIZE] [MODIFIED]

8. Create a new folder (click New Folder button)
9. Double-click the new folder to enter it
   - [ ] URL changes to /files/{folderId}
   - [ ] [..] PARENT_DIR row appears as first item
   - [ ] Breadcrumbs show ~/my vault/{foldername}
10. Click [..] PARENT_DIR row
    - [ ] Returns to root folder
    - [ ] URL changes to /files
11. Navigate into folder again, then use browser back button
    - [ ] Returns to root folder correctly

**File Operations Test:** 12. Upload a file (drag-drop or use upload zone) - [ ] File appears in list - [ ] Size and Modified columns show correct values 13. Right-click file for context menu - [ ] Download works - [ ] Rename works - [ ] Delete works 14. Drag a file to the New Folder (if possible) or right-click and move - [ ] Move operation works

**Mobile Responsiveness Test:** 15. Resize browser to mobile width (<768px) - [ ] Sidebar collapses or becomes overlay - [ ] Layout remains functional - [ ] File list adapts (may hide date column)

**Empty State Test:** 16. Navigate to empty folder - [ ] ASCII art illustration visible - [ ] "// EMPTY DIRECTORY" message shown
</how-to-verify>
<resume-signal>
Type "approved" if all checks pass, or describe specific issues found that need fixing.
</resume-signal>
</task>

<task type="auto">
  <name>Task 3: Apply Style Fixes if Needed</name>
  <files>
    apps/web/src/styles/layout.css
    apps/web/src/styles/file-browser.css
  </files>
  <action>
Apply any style fixes identified during visual verification.

**If checkpoint approved with no issues:**

- No changes needed
- Skip this task

**If issues were reported:**

- Review the specific issues from checkpoint
- Apply targeted CSS fixes
- Common fixes might include:
  - Spacing/padding adjustments
  - Color corrections
  - Z-index issues with dropdowns
  - Grid alignment problems
  - Font size adjustments

**Do not:**

- Make changes not requested in checkpoint feedback
- Refactor working code
- Add new features

**After fixes:**

- Rebuild and verify the specific issues are resolved
  </action>
  <verify>
  If fixes applied: Run `pnpm --filter web build` and verify visually.
  If no fixes needed: Mark as complete.
  </verify>
  <done>
  All style issues from checkpoint resolved (or no issues found). UI matches design specifications.
  </done>
  </task>

</tasks>

<verification>
1. App builds and runs without errors
2. All checkpoint items verified by user
3. Layout matches Pencil design
4. All file operations work
5. Mobile responsive layout functional
6. Any reported issues resolved
</verification>

<success_criteria>

- User approves visual verification checkpoint
- All file operations (upload, download, rename, delete, move) work
- Folder navigation with [..] row works
- Browser history navigation works
- Mobile layout is functional
- No runtime errors in console
  </success_criteria>

<output>
After completion, create `.planning/phases/06.3-ui-structure-refactor/06.3-05-SUMMARY.md`
</output>
