---
phase: 06.3-ui-structure-refactor
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/components/layout/AppShell.tsx
  - apps/web/src/components/layout/AppHeader.tsx
  - apps/web/src/components/layout/AppSidebar.tsx
  - apps/web/src/components/layout/AppFooter.tsx
  - apps/web/src/components/layout/UserMenu.tsx
  - apps/web/src/components/layout/NavItem.tsx
  - apps/web/src/components/layout/StorageQuota.tsx
  - apps/web/src/components/layout/StatusIndicator.tsx
  - apps/web/src/styles/layout.css
autonomous: true

must_haves:
  truths:
    - 'App shell renders with fixed header, sidebar, and footer'
    - 'Header displays logo and user menu'
    - 'Sidebar shows Files and Settings navigation items'
    - 'Footer displays copyright, links, and status indicator'
    - 'Only main content area scrolls'
  artifacts:
    - path: 'apps/web/src/components/layout/AppShell.tsx'
      provides: 'CSS Grid container with header/sidebar/main/footer areas'
      exports: ['AppShell']
    - path: 'apps/web/src/components/layout/AppHeader.tsx'
      provides: 'Header with logo and user menu'
      exports: ['AppHeader']
    - path: 'apps/web/src/components/layout/AppSidebar.tsx'
      provides: 'Navigation sidebar with storage quota'
      exports: ['AppSidebar']
    - path: 'apps/web/src/components/layout/AppFooter.tsx'
      provides: 'Footer with copyright, links, status'
      exports: ['AppFooter']
    - path: 'apps/web/src/styles/layout.css'
      provides: 'CSS Grid layout styles for app shell'
      contains: 'grid-template-areas'
  key_links:
    - from: 'apps/web/src/components/layout/AppShell.tsx'
      to: 'AppHeader, AppSidebar, AppFooter'
      via: 'component composition'
      pattern: 'import.*from.*AppHeader|AppSidebar|AppFooter'
    - from: 'apps/web/src/components/layout/AppSidebar.tsx'
      to: 'quota.store.ts'
      via: 'useQuotaStore hook'
      pattern: 'useQuotaStore'
---

<objective>
Create the foundational AppShell layout components for the new UI structure.

Purpose: Establish the fixed app shell layout (header, sidebar, footer) that will wrap all authenticated routes, replacing the current flexible layout. This is the foundation for the complete UI restructure.

Output: Eight new components in `components/layout/` directory plus CSS styles that implement the fixed layout per the Pencil design specifications.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06.3-ui-structure-refactor/06.3-CONTEXT.md
@.planning/phases/06.3-ui-structure-refactor/06.3-RESEARCH.md
@apps/web/src/index.css
@apps/web/src/App.css
@apps/web/src/stores/quota.store.ts
@apps/web/src/components/ApiStatusIndicator.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Layout CSS and AppShell Component</name>
  <files>
    apps/web/src/styles/layout.css
    apps/web/src/components/layout/AppShell.tsx
  </files>
  <action>
Create the CSS Grid layout system and AppShell wrapper component.

**layout.css:**

- CSS Grid with `grid-template-areas: 'header header' 'sidebar main' 'footer footer'`
- `grid-template-rows: auto 1fr auto` for header/content/footer
- `grid-template-columns: 180px 1fr` for sidebar/main
- `height: 100vh` with `overflow: hidden` on shell
- Main area (`grid-area: main`) is only scrollable container (`overflow-y: auto`)
- Mobile breakpoint at 768px changes to single column layout
- Use existing CSS variables from index.css (--color-_, --spacing-_, --font-\*)
- Add `--color-nav-active: #001a11` for active nav item background

**AppShell.tsx:**

- Wrapper component that renders AppHeader, AppSidebar, children (main content), AppFooter
- Props: `children: React.ReactNode`
- Apply `.app-shell` class from layout.css
- Each child component in its grid area
- Export named export `AppShell`
- Add `data-testid="app-shell"` for testing

**Design specs from RESEARCH.md:**

- Header padding: 12px vertical, 24px horizontal
- Sidebar width: 180px
- Footer padding: 8px vertical, 24px horizontal
- Borders: --color-border-dim (#003322) between sections
  </action>
  <verify>
  Run `pnpm --filter web build` - no TypeScript errors.
  Verify layout.css has grid-template-areas definition.
  Verify AppShell.tsx imports and composes all four layout components.
  </verify>
  <done>
  AppShell component exists with CSS Grid layout. Sidebar is 180px, header/footer fixed, main area scrolls.
  </done>
  </task>

<task type="auto">
  <name>Task 2: Create Header and Footer Components</name>
  <files>
    apps/web/src/components/layout/AppHeader.tsx
    apps/web/src/components/layout/AppFooter.tsx
    apps/web/src/components/layout/UserMenu.tsx
    apps/web/src/components/layout/StatusIndicator.tsx
  </files>
  <action>
Create header and footer components with their sub-components.

**AppHeader.tsx:**

- Fixed header in `.app-header` grid area
- Left side: Logo with `>` prompt (20px, bold) and `CIPHERBOX` (14px, semibold)
- Right side: UserMenu component
- Flex layout with `justify-content: space-between`
- Border bottom: `1px solid var(--color-border-dim)`
- Add `data-testid="app-header"`

**UserMenu.tsx:**

- Hover-triggered dropdown (NOT click)
- Display user email from `useAuth()` hook
- Dropdown items: `[settings]` link to /settings, `[logout]` button
- Use `onMouseEnter/onMouseLeave` for open state (NOT click)
- Position dropdown below email with `position: absolute`
- Terminal style: bracket-wrapped labels `[settings]` `[logout]`
- Add `data-testid="user-menu"`

**AppFooter.tsx:**

- Fixed footer in `.app-footer` grid area
- Three sections: copyright (left), links (center), status (right)
- Copyright: `(c) 2026 CipherBox` - color #003322, 9px
- Links: `[help]` `[privacy]` `[terms]` `[github]` - color #006644, 9px
- Links are placeholder hrefs for now (# or appropriate URLs)
- Status: StatusIndicator component
- Flex layout with space-between
- Border top: `1px solid var(--color-border-dim)`
- Add `data-testid="app-footer"`

**StatusIndicator.tsx:**

- Move logic from existing ApiStatusIndicator.tsx
- Uses `useHealthControllerCheck` hook for API status
- Display: dot + `[CONNECTED]` or `[DISCONNECTED]`
- Green dot with glow when connected (--color-green-primary with box-shadow)
- Red dot when disconnected (--color-error)
- Terminal brackets style
- Add `data-testid="status-indicator"`
  </action>
  <verify>
  Run `pnpm --filter web build` - no TypeScript errors.
  Verify UserMenu imports useAuth hook.
  Verify StatusIndicator uses useHealthControllerCheck hook.
  </verify>
  <done>
  Header shows logo and hover-triggered user menu. Footer shows copyright, links, and connection status indicator.
  </done>
  </task>

<task type="auto">
  <name>Task 3: Create Sidebar Components</name>
  <files>
    apps/web/src/components/layout/AppSidebar.tsx
    apps/web/src/components/layout/NavItem.tsx
    apps/web/src/components/layout/StorageQuota.tsx
    apps/web/src/components/layout/index.ts
  </files>
  <action>
Create sidebar navigation components.

**AppSidebar.tsx:**

- Fixed sidebar in `.app-sidebar` grid area
- Two sections: nav (top) and storage quota (bottom)
- Flex column with `justify-content: space-between`
- Nav items: Files (icon: folder), Settings (icon: gear)
- Files nav active when `location.pathname.startsWith('/files')`
- Settings nav active when `location.pathname === '/settings'`
- Use `useLocation()` from react-router-dom for current path
- Border right: `1px solid var(--color-border-dim)`
- Add `data-testid="app-sidebar"`

**NavItem.tsx:**

- Props: `to: string`, `icon: 'folder' | 'settings'`, `label: string`, `active: boolean`
- Uses react-router-dom `Link` component
- Terminal style: `[FOLDER]` icon prefix (use ASCII: [DIR] for folder, [CFG] for settings)
- Active state: background `--color-nav-active` (#001a11), text bright green
- Inactive state: text dim green (--color-text-secondary)
- Hover: text brightens to primary green
- Padding: 8px vertical, 12px horizontal
- Font: 12px, semibold when active, normal when inactive
- Add `data-testid="nav-item-{label.toLowerCase()}"`

**StorageQuota.tsx:**

- Positioned at bottom of sidebar
- Uses `useQuotaStore` hook for `usedBytes`, `limitBytes`
- Display: progress bar + text
- Progress bar: 6px height, full width, green fill
- Text below: `{used} / {limit}` formatted with formatBytes utility
- Create formatBytes locally or use existing utility if available
- Dim colors for the container (--color-text-secondary)
- Add `data-testid="storage-quota"`

**index.ts:**

- Export all layout components: AppShell, AppHeader, AppSidebar, AppFooter, UserMenu, NavItem, StorageQuota, StatusIndicator
  </action>
  <verify>
  Run `pnpm --filter web build` - no TypeScript errors.
  Verify AppSidebar uses useLocation from react-router-dom.
  Verify StorageQuota uses useQuotaStore.
  Verify index.ts exports all components.
  </verify>
  <done>
  Sidebar shows Files and Settings navigation with active states. Storage quota bar displays usage at bottom of sidebar.
  </done>
  </task>

</tasks>

<verification>
1. All files created in `apps/web/src/components/layout/`
2. `pnpm --filter web build` completes without errors
3. CSS Grid layout defined with correct areas
4. All components have data-testid attributes
5. UserMenu uses hover (not click) for dropdown
6. StatusIndicator reuses health check hook logic
7. StorageQuota connects to quota store
</verification>

<success_criteria>

- 8 new component files in components/layout/
- 1 new CSS file in styles/
- All components export correctly via index.ts
- Build passes with no TypeScript errors
- CSS uses existing design tokens from index.css
  </success_criteria>

<output>
After completion, create `.planning/phases/06.3-ui-structure-refactor/06.3-01-SUMMARY.md`
</output>
