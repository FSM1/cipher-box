---
phase: 06.3-ui-structure-refactor
plan: 04
type: execute
wave: 3
depends_on: ['06.3-02', '06.3-03']
files_modified:
  - apps/web/src/components/file-browser/FileBrowser.tsx
  - apps/web/src/components/file-browser/FolderTree.tsx
  - apps/web/src/components/file-browser/FolderTreeNode.tsx
  - apps/web/src/components/ApiStatusIndicator.tsx
  - apps/web/src/styles/responsive.css
autonomous: true

must_haves:
  truths:
    - 'FileBrowser renders without FolderTree sidebar'
    - 'FileBrowser passes showParentRow and onNavigateUp to FileList'
    - 'Mobile layout works with new AppShell structure'
    - 'Deprecated components marked for future removal'
    - 'All file operations (upload, download, rename, delete) still work'
  artifacts:
    - path: 'apps/web/src/components/file-browser/FileBrowser.tsx'
      provides: 'Updated FileBrowser without sidebar'
      exports: ['FileBrowser']
    - path: 'apps/web/src/styles/responsive.css'
      provides: 'Mobile styles for new layout'
      contains: '@media.*768px'
  key_links:
    - from: 'apps/web/src/components/file-browser/FileBrowser.tsx'
      to: 'FileList.tsx'
      via: 'showParentRow and onNavigateUp props'
      pattern: 'showParentRow.*onNavigateUp'
---

<objective>
Wire FileBrowser to new components, remove FolderTree, and update responsive styles.

Purpose: Complete the integration by updating FileBrowser to work without the sidebar FolderTree (now using in-place navigation), connect the ParentDirRow navigation, and ensure mobile responsiveness works with the new AppShell layout.

Output: FileBrowser updated to use in-place navigation, deprecated components marked, responsive styles adapted for AppShell.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06.3-ui-structure-refactor/06.3-CONTEXT.md
@.planning/phases/06.3-ui-structure-refactor/06.3-RESEARCH.md
@.planning/phases/06.3-ui-structure-refactor/06.3-01-SUMMARY.md
@.planning/phases/06.3-ui-structure-refactor/06.3-02-SUMMARY.md
@.planning/phases/06.3-ui-structure-refactor/06.3-03-SUMMARY.md
@apps/web/src/components/file-browser/FileBrowser.tsx
@apps/web/src/styles/responsive.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update FileBrowser to Remove FolderTree</name>
  <files>
    apps/web/src/components/file-browser/FileBrowser.tsx
  </files>
  <action>
Remove FolderTree sidebar from FileBrowser and wire up in-place navigation.

**Major changes to FileBrowser.tsx:**

1. **Remove FolderTree imports and usage:**
   - Remove `import { FolderTree } from './FolderTree';`
   - Remove the entire `<aside className={sidebarClassName}>` block with FolderTree
   - Remove mobile sidebar state (`sidebarOpen`, `setSidebarOpen`, `isMobile`, `setIsMobile`)
   - Remove sidebar-related callbacks (`toggleSidebar`, `closeSidebar`)
   - Remove mobile backdrop div
   - Remove mobile hamburger toggle button in toolbar

2. **Update FileList props:**
   - Add `showParentRow` prop: `showParentRow={currentFolderId !== 'root'}`
   - Add `onNavigateUp` prop: `onNavigateUp={navigateUp}`

   ```tsx
   <FileList
     items={children}
     selectedId={selectedItemId}
     parentId={currentFolderId}
     showParentRow={currentFolderId !== 'root'}
     onNavigateUp={navigateUp}
     onSelect={handleSelect}
     onNavigate={handleNavigate}
     onContextMenu={handleContextMenu}
     onDragStart={handleDragStart}
   />
   ```

3. **Simplify component structure:**
   - Remove flex layout wrapping (no more sidebar/main split)
   - FileBrowser now only contains the main content area
   - Keep the toolbar, file list, empty state, dialogs, and upload modal

4. **Update handleDrop for drag operations:**
   - Since there's no FolderTree, drag-to-folder works differently
   - For now, keep the drag handler but it may need adjustment
   - Drag-drop to move files can still work if user drags to a folder row in the list

5. **Clean up resize listener:**
   - Remove window resize listener for mobile detection (no longer needed)

6. **Simplify className:**
   - Change from `<div className="file-browser">` to just the main content
   - May need to adjust wrapper class or remove it

**Resulting structure:**

```tsx
return (
  <div className="file-browser-content">
    {/* Toolbar with breadcrumbs and actions */}
    <div className="file-browser-toolbar">
      <Breadcrumbs ... />
      <div className="file-browser-actions">
        <button className="file-browser-new-folder-button" ...>
        <UploadZone ... />
      </div>
    </div>

    {/* Loading state */}
    {isLoading && <div className="file-browser-loading">...</div>}

    {/* File list or empty state */}
    {!isLoading && hasChildren && <FileList ... showParentRow={currentFolderId !== 'root'} onNavigateUp={navigateUp} />}
    {!isLoading && !hasChildren && <EmptyState ... />}

    {/* Context menu and dialogs */}
    ...
  </div>
);
```

  </action>
  <verify>
Run `pnpm --filter web build` - no TypeScript errors.
Verify FolderTree is not imported.
Verify FileList receives showParentRow and onNavigateUp props.
  </verify>
  <done>
FileBrowser renders without FolderTree sidebar. FileList receives showParentRow and onNavigateUp props for in-place navigation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Mark Deprecated Components and Update Responsive Styles</name>
  <files>
    apps/web/src/components/file-browser/FolderTree.tsx
    apps/web/src/components/file-browser/FolderTreeNode.tsx
    apps/web/src/components/ApiStatusIndicator.tsx
    apps/web/src/styles/responsive.css
  </files>
  <action>
Mark deprecated components and update responsive styles for new layout.

**FolderTree.tsx:**
Add deprecation notice at top of file:

```tsx
/**
 * @deprecated This component is no longer used as of Phase 6.3.
 * Folder navigation is now handled via in-place navigation with ParentDirRow.
 * This file is kept for reference and will be removed in a future cleanup.
 */
```

**FolderTreeNode.tsx:**
Add deprecation notice at top of file:

```tsx
/**
 * @deprecated This component is no longer used as of Phase 6.3.
 * See FolderTree.tsx for details.
 */
```

**ApiStatusIndicator.tsx:**
Add deprecation notice at top of file:

```tsx
/**
 * @deprecated This component is replaced by StatusIndicator in components/layout/.
 * The status indicator is now in the app footer.
 * This file is kept for reference and will be removed in a future cleanup.
 */
```

**responsive.css updates:**

1. **Remove old sidebar responsive styles:**
   - Comment out or remove `.file-browser-sidebar--*` mobile styles
   - Comment out or remove `.file-browser-backdrop` styles
   - Comment out or remove `.file-browser-toggle` styles

2. **Add AppShell responsive styles:**

```css
/* Mobile layout - AppShell */
@media (max-width: 768px) {
  .app-shell {
    grid-template-columns: 1fr;
    grid-template-areas:
      'header'
      'main'
      'footer';
  }

  .app-sidebar {
    position: fixed;
    left: 0;
    top: 0;
    bottom: 0;
    width: 180px;
    transform: translateX(-100%);
    transition: transform 0.2s ease;
    z-index: 100;
  }

  .app-sidebar--open {
    transform: translateX(0);
  }

  .app-header {
    padding: var(--spacing-xs) var(--spacing-sm);
  }

  .app-footer {
    padding: var(--spacing-xs) var(--spacing-sm);
  }

  /* Footer links hidden on mobile */
  .footer-center {
    display: none;
  }
}
```

3. **Update file list responsive styles:**

```css
@media (max-width: 768px) {
  /* 2-column layout on mobile: name + size, date hidden */
  .file-list-header {
    grid-template-columns: 1fr 80px;
  }

  .file-list-item {
    grid-template-columns: 1fr 80px;
  }

  .file-list-header-date,
  .file-list-item-date {
    display: none;
  }
}
```

4. **Keep existing file list mobile styles** that convert to stacked layout if that's the current approach.
   </action>
   <verify>
   Run `pnpm --filter web build` - no TypeScript errors.
   Verify deprecated components have @deprecated JSDoc.
   Verify responsive.css has updated AppShell mobile styles.
   </verify>
   <done>
   FolderTree, FolderTreeNode, and ApiStatusIndicator marked as deprecated. Responsive styles updated for AppShell mobile layout.
   </done>
   </task>

<task type="auto">
  <name>Task 3: Update file-browser.css and Final Integration</name>
  <files>
    apps/web/src/styles/file-browser.css
    apps/web/src/components/file-browser/index.ts
  </files>
  <action>
Clean up file-browser styles and ensure proper exports.

**file-browser.css changes:**

1. **Remove sidebar-related styles or mark as deprecated:**

```css
/* ==========================================================================
   DEPRECATED: Sidebar styles - no longer used as of Phase 6.3
   Sidebar is now in AppShell layout
   ========================================================================== */
/*
.file-browser-sidebar { ... }
.file-browser-sidebar--open { ... }
.file-browser-sidebar--closed { ... }
*/
```

2. **Update main container styles:**

```css
/* File Browser Content - now without sidebar */
.file-browser-content {
  display: flex;
  flex-direction: column;
  height: 100%;
  background-color: var(--color-background);
}

.file-browser-main {
  flex: 1;
  min-width: 0;
  overflow-y: auto;
  padding: var(--spacing-md);
  background-color: var(--color-background);
}
```

3. **Keep toolbar styles** - they're still used.

4. **Keep file list styles** - updated in Plan 03.

5. **Comment out or remove folder tree styles:**

```css
/* ==========================================================================
   DEPRECATED: Folder Tree styles - no longer used as of Phase 6.3
   ========================================================================== */
/*
.folder-tree { ... }
.folder-tree-header { ... }
.folder-tree-item { ... }
*/
```

**index.ts (file-browser component barrel):**

1. Keep existing exports:

```tsx
export { FileBrowser } from './FileBrowser';
export { FileList } from './FileList';
export { FileListItem } from './FileListItem';
export { EmptyState } from './EmptyState';
export { ParentDirRow } from './ParentDirRow'; // Add this
// ... other exports
```

2. Keep FolderTree exports but they're deprecated:

```tsx
// @deprecated - kept for backwards compatibility
export { FolderTree } from './FolderTree';
export { FolderTreeNode } from './FolderTreeNode';
```

  </action>
  <verify>
Run `pnpm --filter web build` - no TypeScript errors.
Run `pnpm --filter web dev` and verify the app renders correctly.
Verify ParentDirRow is exported from index.ts.
  </verify>
  <done>
file-browser.css cleaned up with deprecated sections marked. All components properly exported. Build passes.
  </done>
</task>

</tasks>

<verification>
1. FileBrowser renders without FolderTree sidebar
2. FileList receives and uses showParentRow and onNavigateUp props
3. Clicking [..] PARENT_DIR navigates to parent folder
4. Mobile layout works with AppShell (sidebar hidden by default)
5. Deprecated components have @deprecated JSDoc
6. `pnpm --filter web build` passes
7. `pnpm --filter web dev` shows functional UI
8. All file operations still work (upload, download, rename, delete)
</verification>

<success_criteria>

- FileBrowser.tsx updated without FolderTree
- FolderTree.tsx, FolderTreeNode.tsx, ApiStatusIndicator.tsx marked deprecated
- responsive.css updated for AppShell layout
- file-browser.css cleaned up
- ParentDirRow exported from index.ts
- Build passes
- App is functional with new layout
  </success_criteria>

<output>
After completion, create `.planning/phases/06.3-ui-structure-refactor/06.3-04-SUMMARY.md`
</output>
