---
phase: 09-desktop-client
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/desktop/src-tauri/Cargo.toml
  - apps/desktop/src-tauri/src/main.rs
  - apps/desktop/src-tauri/tauri.conf.json
  - apps/desktop/src-tauri/capabilities/default.json
  - apps/desktop/src-tauri/build.rs
  - apps/desktop/package.json
  - apps/desktop/tsconfig.json
  - apps/desktop/src/main.ts
  - apps/desktop/index.html
autonomous: true

must_haves:
  truths:
    - "Tauri desktop app compiles and launches on macOS"
    - "App is a proper pnpm workspace member under apps/desktop"
    - "Cargo check passes with all Rust dependencies resolved"
    - "No default window -- app starts headless (menu bar only)"
  artifacts:
    - path: "apps/desktop/src-tauri/Cargo.toml"
      provides: "Rust dependencies including tauri, fuser, keyring, reqwest, aes-gcm, ecies, ed25519-dalek, tokio"
    - path: "apps/desktop/src-tauri/tauri.conf.json"
      provides: "Tauri configuration with tray-icon, deep-link, no default window"
    - path: "apps/desktop/package.json"
      provides: "Desktop app package in pnpm workspace"
  key_links:
    - from: "apps/desktop/package.json"
      to: "pnpm-workspace.yaml"
      via: "apps/* glob includes apps/desktop automatically"
      pattern: "apps/\\*"
---

<objective>
Scaffold the Tauri v2 desktop app within the monorepo. This is the bare skeleton: Cargo.toml with all dependencies, tauri.conf.json, a minimal main.rs that registers plugins and starts headless, and the frontend shell (index.html + main.ts) used later for Web3Auth.

Purpose: Establish the compilable Tauri app that all subsequent plans build on. Keeping this separate from the crypto module ensures the scaffold compiles clean before adding complexity.

Output: A compilable Tauri app visible in pnpm workspace. No crypto, no auth, no FUSE -- just the shell.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-desktop-client/09-CONTEXT.md
@.planning/phases/09-desktop-client/09-RESEARCH.md
@pnpm-workspace.yaml
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Tauri v2 app in monorepo</name>
  <files>
    apps/desktop/package.json
    apps/desktop/tsconfig.json
    apps/desktop/src/main.ts
    apps/desktop/index.html
    apps/desktop/src-tauri/Cargo.toml
    apps/desktop/src-tauri/tauri.conf.json
    apps/desktop/src-tauri/capabilities/default.json
    apps/desktop/src-tauri/build.rs
    apps/desktop/src-tauri/src/main.rs
  </files>
  <action>
    Create the `apps/desktop` directory as a new pnpm workspace member. The existing `pnpm-workspace.yaml` already has `apps/*` so it will be auto-included.

    **package.json**: Create with name `@cipherbox/desktop`, type `module`, scripts for `tauri dev` and `tauri build`. Dependencies: `@tauri-apps/api` ^2, `@tauri-apps/cli` ^2 (devDep), `@tauri-apps/plugin-deep-link` ^2, `@tauri-apps/plugin-shell` ^2.

    **tsconfig.json**: Extend from `@cipherbox/tsconfig/base.json` (the shared config). Target ESNext, module ESNext, moduleResolution bundler.

    **index.html**: Minimal HTML shell for Tauri webview. Single div with id="app". Script tag pointing to `src/main.ts`. This webview is used for Web3Auth login in plan 09-04.

    **src/main.ts**: Minimal entry point. Import `@tauri-apps/api`. Log "CipherBox Desktop ready". This will be expanded in plan 09-04 for auth flow.

    **Cargo.toml**: Create with these dependencies:
    ```toml
    [package]
    name = "cipherbox-desktop"
    version = "0.1.0"
    edition = "2021"

    [dependencies]
    tauri = { version = "2", features = ["tray-icon"] }
    tauri-plugin-deep-link = "2"
    tauri-plugin-autostart = "2"
    tauri-plugin-shell = "2"
    tauri-plugin-notification = "2"
    fuser = { version = "0.16", default-features = false }
    keyring = { version = "3", features = ["apple-native"] }
    reqwest = { version = "0.12", features = ["json", "rustls-tls"] }
    tokio = { version = "1", features = ["full"] }
    serde = { version = "1", features = ["derive"] }
    serde_json = "1"
    aes-gcm = "0.10"
    ecies = { version = "0.2", default-features = false, features = ["pure"] }
    ed25519-dalek = { version = "2", features = ["rand_core"] }
    rand = "0.8"
    hex = "0.4"
    base64 = "0.22"
    dirs = "5"
    log = "0.4"
    env_logger = "0.11"
    libc = "0.2"
    thiserror = "2"
    zeroize = "1"
    prost = "0.13"
    ciborium = "0.2"
    multihash = { version = "0.19", features = ["identity"] }
    unsigned-varint = "0.8"

    [build-dependencies]
    tauri-build = { version = "2", features = [] }
    ```

    Note: `prost`, `ciborium`, `multihash`, and `unsigned-varint` are included for IPNS record creation in plan 09-02. Including them now avoids recompilation.

    **tauri.conf.json**: Configure with:
    - `identifier`: "com.cipherbox.desktop"
    - `app.windows`: [] (empty -- no default window, menu bar only)
    - `plugins.deep-link.desktop.schemes`: ["cipherbox"]
    - `bundle.identifier`: "com.cipherbox.desktop"
    - `bundle.macOS.entitlements`: null (will add signing later)
    - `app.security.dangerousDisableAssetCspModification`: true (needed for Web3Auth redirect)
    - `build.devUrl`: "http://localhost:1420" (Tauri default for Vite)
    - `build.frontendDist`: "../dist"
    - `build.beforeDevCommand`: "" (empty, no frontend dev server needed since webview is minimal)
    - `build.beforeBuildCommand`: "" (empty)

    **capabilities/default.json**: Grant permissions for deep-link, shell open-url, notification, autostart.

    **build.rs**: Standard Tauri build script: `tauri_build::build()`.

    **main.rs**: Minimal Tauri app that compiles and runs:
    - Register plugins: deep-link, autostart (MacosLauncher::LaunchAgent), shell, notification
    - In setup: set ActivationPolicy::Accessory (hide dock icon)
    - Register empty invoke_handler (commands added in later plans)
    - No window creation -- app starts headless
    - Print log message "CipherBox Desktop starting..."

    Do NOT add FUSE mounting, tray icon, crypto modules, or auth -- those come in later plans. This task is scaffold only.
  </action>
  <verify>
    Run `cd apps/desktop && pnpm install` to verify workspace resolution.
    Run `cd apps/desktop/src-tauri && cargo check` to verify Rust compilation (may take a few minutes for first build).
    Verify `tauri.conf.json` is valid JSON.
    Verify the app is included in pnpm workspace by running `pnpm ls --filter @cipherbox/desktop`.
  </verify>
  <done>
    `cargo check` passes without errors. Package visible in pnpm workspace. Tauri conf valid. No crypto/auth/FUSE code -- just the compilable shell.
  </done>
</task>

</tasks>

<verification>
- `cargo check` succeeds for the Tauri app
- The desktop app package is visible in `pnpm ls -r`
- tauri.conf.json has no default windows, has deep-link scheme "cipherbox", identifier "com.cipherbox.desktop"
- main.rs registers plugins: deep-link, autostart, shell, notification
- main.rs sets ActivationPolicy::Accessory
</verification>

<success_criteria>
Tauri app compiles. Desktop app is a proper pnpm workspace member. All Rust dependencies resolve without errors.
</success_criteria>

<output>
After completion, create `.planning/phases/09-desktop-client/09-01-SUMMARY.md`
</output>
