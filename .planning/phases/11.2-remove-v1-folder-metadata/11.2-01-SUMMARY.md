---
phase: 11.2-remove-v1-folder-metadata
plan: 01
subsystem: crypto
tags: [typescript, folder-metadata, type-cleanup, v2-canonical]

# Dependency graph
requires:
  - phase: 12.6-per-file-ipns-metadata
    provides: FolderMetadataV2 and FilePointer types (v2 schema)
provides:
  - Canonical FolderMetadata type (v2 schema, no V2 suffix)
  - Canonical FolderChild type (FolderEntry | FilePointer)
  - Strict validateFolderMetadata that rejects v1 data
  - Clean web app imports with no V2 suffixes or v1 guards
affects: [11.2-02-PLAN (desktop Rust types), 11.2-03-PLAN (recovery tool)]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - 'Single schema pattern: only v2 FolderMetadata exists, no union types'

key-files:
  created: []
  modified:
    - packages/crypto/src/folder/types.ts
    - packages/crypto/src/folder/metadata.ts
    - packages/crypto/src/folder/index.ts
    - packages/crypto/src/index.ts
    - packages/crypto/src/__tests__/folder-metadata.test.ts
    - packages/crypto/src/__tests__/file-ipns.test.ts
    - apps/web/src/services/folder.service.ts
    - apps/web/src/stores/folder.store.ts
    - apps/web/src/components/file-browser/FileBrowser.tsx
    - apps/web/src/components/file-browser/DetailsDialog.tsx
    - apps/web/src/components/file-browser/FileList.tsx
    - apps/web/src/components/file-browser/FileListItem.tsx
    - apps/web/src/components/file-browser/ContextMenu.tsx
    - apps/web/src/components/file-browser/MoveDialog.tsx
    - apps/web/src/components/file-browser/SelectionActionBar.tsx
    - apps/web/src/hooks/useContextMenu.ts
    - apps/web/src/hooks/useFolder.ts

key-decisions:
  - "Simplified isFilePointer to type discriminant check only (item.type === 'file')"
  - 'Removed v1 fallback branch from DetailsDialog (no legacy entry display)'
  - 'validateFolderMetadata rejects v1 with CryptoError (not silent acceptance)'

patterns-established:
  - "FolderMetadata always means v2 (version: 'v2', children: FolderChild[])"
  - 'FolderChild is FolderEntry | FilePointer (no FileEntry type exists)'

# Metrics
duration: 7min
completed: 2026-02-19
---

# Phase 11.2 Plan 01: Delete v1 Folder Types Summary

**Canonical FolderMetadata/FolderChild types replace v2-suffixed and v1 types across crypto package and web app**

## Performance

- **Duration:** 7 min
- **Started:** 2026-02-19T02:07:03Z
- **Completed:** 2026-02-19T02:14:30Z
- **Tasks:** 3
- **Files modified:** 17

## Accomplishments

- Deleted FileEntry, FolderMetadataV2, FolderChildV2, AnyFolderMetadata types and isV2Metadata guard
- Renamed FolderMetadataV2 to FolderMetadata, FolderChildV2 to FolderChild (canonical names)
- Updated all 11 web app files to use canonical imports with no V2 suffixes
- Added v1 rejection tests and v2-only test fixtures (225/225 tests pass)

## Task Commits

Each task was committed atomically:

1. **Task 1: Delete v1 types, rename v2 to canonical in crypto package** - `cda27d5d9` (refactor)
2. **Task 2: Update all web app imports and remove v1 guards** - `dece5fe72` (refactor)
3. **Task 3: Update crypto package tests** - `8458cb6a9` (test)

## Files Created/Modified

- `packages/crypto/src/folder/types.ts` - Canonical FolderMetadata, FolderChild types (no V2 suffix, no FileEntry, no AnyFolderMetadata)
- `packages/crypto/src/folder/metadata.ts` - Strict v2-only validator, encrypt/decrypt accepting FolderMetadata only
- `packages/crypto/src/folder/index.ts` - Clean exports without V2 suffixes or v1 types
- `packages/crypto/src/index.ts` - Removed isV2Metadata, FileEntry, FolderMetadataV2, FolderChildV2, AnyFolderMetadata exports
- `packages/crypto/src/__tests__/folder-metadata.test.ts` - v2-only test fixtures, v1 rejection tests
- `packages/crypto/src/__tests__/file-ipns.test.ts` - Removed isV2Metadata tests, updated type annotations
- `apps/web/src/services/folder.service.ts` - FolderChild/FolderMetadata canonical imports
- `apps/web/src/stores/folder.store.ts` - FolderChild canonical import
- `apps/web/src/components/file-browser/FileBrowser.tsx` - Simplified isFilePointer, removed v1 cast
- `apps/web/src/components/file-browser/DetailsDialog.tsx` - Removed v1 fallback branch
- `apps/web/src/components/file-browser/FileList.tsx` - FolderChild canonical import
- `apps/web/src/components/file-browser/FileListItem.tsx` - FolderChild canonical import
- `apps/web/src/components/file-browser/ContextMenu.tsx` - FolderChild canonical import
- `apps/web/src/components/file-browser/MoveDialog.tsx` - FolderChild canonical import
- `apps/web/src/components/file-browser/SelectionActionBar.tsx` - FolderChild canonical import
- `apps/web/src/hooks/useContextMenu.ts` - FolderChild canonical import
- `apps/web/src/hooks/useFolder.ts` - FolderChild canonical import

## Decisions Made

- Simplified isFilePointer guard to `item.type === 'file'` (no need to check for fileMetaIpnsName presence since all file children are now FilePointer)
- Removed v1 fallback "legacy entry" display from DetailsDialog (v1 data cannot exist at runtime)
- validateFolderMetadata rejects v1 data with CryptoError (strict enforcement, not silent acceptance)

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- TypeScript crypto package and web app fully migrated to canonical names
- Ready for Plan 02 (desktop Rust types) to mirror this cleanup
- Ready for Plan 03 (recovery tool) to remove v1 handling

---

_Phase: 11.2-remove-v1-folder-metadata_
_Completed: 2026-02-19_
