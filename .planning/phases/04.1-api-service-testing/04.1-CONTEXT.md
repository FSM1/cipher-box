# Phase 4.1: API Service Testing - Context

**Gathered:** 2026-01-20
**Status:** Ready for planning

<domain>
## Phase Boundary

Add comprehensive unit tests to backend services (Auth, Vault, IPFS) to meet coverage thresholds defined in TESTING.md. Establish TDD workflow for future development.

</domain>

<decisions>
## Implementation Decisions

All testing decisions are defined in `.planning/codebase/TESTING.md`. Key specifications:

### Coverage Thresholds (from TESTING.md)

- Auth Services: 90% line, 85% branch
- Vault Services: 90% line, 85% branch
- IPFS Services: 85% line, 80% branch
- Controllers: 80% line, 75% branch
- Overall minimum: 85% line, 80% branch

### Mocking Strategy (from TESTING.md)

**Mock:**

- Database connections and queries
- IPFS client operations
- Pinata API calls
- Web3Auth verification
- External HTTP services

**Do NOT mock:**

- Cryptographic functions (always test real encryption)
- Data conversion utilities
- Validation logic

### Test Organization (from TESTING.md)

- Framework: Jest with `@nestjs/testing`
- HTTP Testing: Supertest
- Coverage: Jest/Istanbul with enforced thresholds

### TDD Workflow (from TESTING.md)

- Red-Green-Refactor cycle mandatory
- No production code without failing test first
- Commit after each green phase

### Claude's Discretion

- Test file naming conventions (`.spec.ts` vs `.test.ts`)
- Fixture factory implementation details
- Order of test implementation within each service

</decisions>

<specifics>
## Specific Ideas

No additional requirements beyond TESTING.md specifications.

</specifics>

<deferred>
## Deferred Ideas

None â€” discussion stayed within phase scope.

</deferred>

---

_Phase: 04.1-api-service-testing_
_Context gathered: 2026-01-20_
