---
phase: 12.5-mfa-polishing-uat-e2e
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/src/routes/SettingsPage.tsx
  - apps/web/src/routes/Settings.tsx
autonomous: true

must_haves:
  truths:
    - 'Settings page shows LINKED METHODS and SECURITY tabs'
    - 'Clicking SECURITY tab reveals MFA enrollment wizard and device management'
    - 'SecurityTab component renders with correct MFA status badge'
    - 'VaultExport still accessible from settings page'
  artifacts:
    - path: 'apps/web/src/routes/SettingsPage.tsx'
      provides: 'Settings page with tab navigation including SecurityTab'
      contains: 'SecurityTab'
    - path: 'apps/web/src/routes/Settings.tsx'
      provides: 'Removed or repurposed (no longer orphaned)'
  key_links:
    - from: 'apps/web/src/routes/SettingsPage.tsx'
      to: 'apps/web/src/components/mfa/SecurityTab.tsx'
      via: 'import and render in security tab panel'
      pattern: 'import.*SecurityTab'
    - from: 'apps/web/src/routes/SettingsPage.tsx'
      to: 'apps/web/src/components/auth/LinkedMethods.tsx'
      via: 'import and render in linked-methods tab panel'
      pattern: 'import.*LinkedMethods'
---

<objective>
Fix ISSUE-004: Wire SecurityTab into SettingsPage with proper ARIA tab navigation

Purpose: Unblocks MFA enrollment (TC25-31) and MFA login flows (TC15-23) that require SecurityTab to be accessible from the Settings page. Currently SettingsPage.tsx only renders LinkedMethods + VaultExport, while Settings.tsx (which has the tab UI + SecurityTab) is orphaned and never routed to.

Output: SettingsPage.tsx with tabbed navigation (LINKED METHODS | SECURITY), SecurityTab accessible, VaultExport preserved as separate section below tabs.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/debug/corekit-auth-uat.md

Key context:

- `apps/web/src/routes/SettingsPage.tsx` -- currently routed component, only has LinkedMethods + VaultExport
- `apps/web/src/routes/Settings.tsx` -- orphaned file with ARIA tablist, tab panels, and SecurityTab import (the correct tab UI)
- `apps/web/src/components/mfa/SecurityTab.tsx` -- exists and works, just not routed
- `apps/web/src/routes/index.tsx` -- routes /settings to SettingsPage
- CSS for settings-tab classes already exists in App.css
  </context>

<tasks>

<task type="auto">
<name>Task 1: Merge Settings.tsx tab UI into SettingsPage.tsx and remove orphan</name>
<files>apps/web/src/routes/SettingsPage.tsx, apps/web/src/routes/Settings.tsx</files>
<action>
Replace the flat layout in SettingsPage.tsx with the tabbed ARIA UI from Settings.tsx, while preserving the AppShell wrapper and VaultExport section that SettingsPage has.

In `SettingsPage.tsx`:

- Add `useState` import and `SettingsTabId` type (`'linked-methods' | 'security'`)
- Import `SecurityTab` from `../../components/mfa/SecurityTab`
- Keep existing `useAuth`, `useNavigate`, `AppShell` wrapper, auth redirect logic, loading state
- Replace the flat `<div className="settings-content">` body with the ARIA tabbed structure from Settings.tsx:
  - Section heading: `{'// account & security'}` with description text
  - Tab bar: `<div className="settings-tabs" role="tablist">` with LINKED METHODS and SECURITY tab buttons
  - Tab panels with `role="tabpanel"`, `hidden` attribute, conditional rendering
  - LinkedMethods in linked-methods panel, SecurityTab in security panel
- Keep VaultExport as a separate section BELOW the tab panels (it is not a tab, it is always visible):

```tsx
<section className="settings-section" style={{ marginTop: 'var(--spacing-md)' }}>
  <VaultExport />
</section>
```

- Preserve the `[SETTINGS]` title at the top as `<h2 className="settings-title">[SETTINGS]</h2>`

Delete `apps/web/src/routes/Settings.tsx` -- it is now fully merged into SettingsPage.tsx and no longer needed. Verify no other file imports from it first (grep for `from './Settings'` or `from '../routes/Settings'`).

The resulting SettingsPage.tsx should:

- Be wrapped in AppShell (preserving existing behavior)
- Have auth guard (preserving existing behavior)
- Show tab navigation with ARIA attributes (role=tablist, role=tab, role=tabpanel, aria-selected, aria-controls, aria-labelledby)
- Default to 'linked-methods' tab
- Show VaultExport below the tabs always
- Use existing CSS classes (settings-tabs, settings-tab, active, security-tab-\*, etc.) which are already in App.css
  </action>
  <verify>

1. `grep -r "Settings.tsx" apps/web/src/routes/ --include="*.tsx"` shows no import of the orphaned file
2. `grep "SecurityTab" apps/web/src/routes/SettingsPage.tsx` shows the import
3. `grep "role=\"tablist\"" apps/web/src/routes/SettingsPage.tsx` confirms ARIA tab structure
4. `grep "VaultExport" apps/web/src/routes/SettingsPage.tsx` confirms VaultExport preserved
5. `pnpm --filter web build` succeeds with no TypeScript errors
   </verify>
   <done>
   SettingsPage.tsx has tabbed UI with LINKED METHODS and SECURITY tabs. SecurityTab is accessible. VaultExport is below tabs. Settings.tsx orphan is deleted. Build passes.
   </done>
   </task>

</tasks>

<verification>

- `pnpm --filter web build` completes without errors
- `grep -rn "Settings.tsx" apps/web/src/ --include="*.tsx"` returns no references to the deleted orphan
- SettingsPage.tsx contains: SecurityTab import, role="tablist", role="tabpanel", VaultExport

</verification>

<success_criteria>

- ISSUE-004 is resolved: SecurityTab is accessible from the Settings page via tab navigation
- SettingsPage.tsx has ARIA-compliant tab structure (tablist, tab, tabpanel)
- VaultExport remains accessible (not hidden behind a tab)
- No orphaned files remain
- Web app builds cleanly

</success_criteria>

<output>
After completion, create `.planning/phases/12.5-mfa-polishing-uat-e2e/12.5-01-SUMMARY.md`
</output>
