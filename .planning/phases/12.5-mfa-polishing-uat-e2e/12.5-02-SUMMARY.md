---
phase: 12.5-mfa-polishing-uat-e2e
plan: 02
subsystem: testing
tags: [playwright, wallet-mock, eip-6963, siwe, e2e, wagmi]

# Dependency graph
requires:
  - phase: 12.3
    provides: WalletLoginButton component with EIP-6963 connector discovery and SIWE flow
  - phase: 12.4
    provides: E2E test infrastructure with Playwright config and page objects
provides:
  - Wallet E2E test suite (TC09-TC12) using mock EIP-6963 provider
  - Extended LoginPage page object with wallet-specific selectors and methods
  - @johanneskares/wallet-mock installed in e2e package
affects: [12.5-mfa-polishing-uat-e2e]

# Tech tracking
tech-stack:
  added: ["@johanneskares/wallet-mock ^1.4.1", "viem ^2.44.4 (e2e devDep)"]
  patterns: [EIP-6963 mock provider injection before page.goto, Hardhat account #0 for deterministic test keys]

key-files:
  created:
    - tests/e2e/tests/wallet-login.spec.ts
  modified:
    - tests/e2e/package.json
    - tests/e2e/page-objects/login.page.ts
    - pnpm-lock.yaml

key-decisions:
  - "Hardhat account #0 for test wallet key (well-known, deterministic, no real funds)"
  - "Tests validate frontend UI flow independent of Core Kit availability"
  - "TC11 handles phantom injected connectors from browser built-in wallet detection"

patterns-established:
  - "installMockWallet before page.goto pattern for EIP-6963 mock injection"
  - "Promise.race for testing flows that may succeed or fail depending on backend state"
  - "page.route interception for simulating backend errors in E2E tests"

# Metrics
duration: 3min
completed: 2026-02-16
---

# Phase 12.5 Plan 02: Wallet E2E Tests Summary

Wallet login E2E test suite (TC09-TC12) with @johanneskares/wallet-mock for EIP-6963 mock provider injection and real ECDSA signature verification.

## Performance

- **Duration:** 3 min
- **Started:** 2026-02-16T20:18:04Z
- **Completed:** 2026-02-16T20:21:35Z
- **Tasks:** 2
- **Files modified:** 4

## Accomplishments

- Installed @johanneskares/wallet-mock and viem as e2e devDependencies
- Extended LoginPage page object with 10 wallet-specific methods (clickWalletLogin, getWalletConnectors, selectWalletConnector, cancelWalletLogin, getWalletError, isWalletConnectorListVisible, getWalletStatus, isWalletLoginButtonVisible, isWalletLoginButtonEnabled, isNoWalletProvidersVisible)
- Created wallet-login.spec.ts with 6 tests across 4 describe blocks covering TC09 (happy path), TC10 (cancel), TC11 (no wallet), TC12 (error handling)
- All tests compile and are listable by Playwright (287 lines, well above 80 line minimum)

## Task Commits

Each task was committed atomically:

1. **Task 1: Install wallet-mock and add wallet selectors to LoginPage** - `f518de29c` (chore)
2. **Task 2: Create wallet-login.spec.ts with TC09-TC12 test cases** - `ab8a8f95d` (test)

## Files Created/Modified

- `tests/e2e/tests/wallet-login.spec.ts` - Wallet login E2E test suite with 6 tests across TC09-TC12
- `tests/e2e/page-objects/login.page.ts` - Extended with wallet selectors and methods
- `tests/e2e/package.json` - Added @johanneskares/wallet-mock and viem devDependencies
- `pnpm-lock.yaml` - Updated lockfile

## Decisions Made

- **Hardhat account #0 for test key:** Well-known deterministic key (0xac0974...2ff80) ensures reproducible tests without real wallet funds
- **Tests validate UI flow independently of Core Kit:** TC09 SIWE test accepts both redirect-to-files (full success) and error (backend/Core Kit unavailable) as valid since the point is to verify the frontend wallet interaction
- **TC11 handles phantom connectors:** wagmi may report browser built-in injected connectors even when no wallet extension is installed, so the test checks for Mock Wallet absence rather than strictly zero connectors

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

- Pre-existing TypeScript errors in `tests/e2e/utils/web3auth-helpers.ts` (Window type casting) - confirmed pre-existing by stashing changes and re-running tsc. Not related to wallet-mock changes.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Wallet E2E tests are ready to run against a full backend + Core Kit environment
- LoginPage page object is now complete with email, Google, and wallet selectors
- Next plan (12.5-03) can build on this test infrastructure

---

_Phase: 12.5-mfa-polishing-uat-e2e_
_Completed: 2026-02-16_
