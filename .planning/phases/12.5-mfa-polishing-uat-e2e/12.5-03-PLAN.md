---
phase: 12.5-mfa-polishing-uat-e2e
plan: 03
type: execute
wave: 2
depends_on: ['12.5-01', '12.5-02']
files_modified: []
autonomous: false

must_haves:
  truths:
    - 'Wallet E2E tests pass (TC09-TC12 or documented as environment-dependent)'
    - 'MFA enrollment accessible from Settings > Security tab'
    - 'All auth UAT test cases have a final status (PASS, SKIP with reason, or documented BLOCK)'
  artifacts:
    - path: '.planning/debug/corekit-auth-uat.md'
      provides: 'Updated UAT results with final status for all 36 test cases'
  key_links:
    - from: 'tests/e2e/tests/wallet-login.spec.ts'
      to: 'apps/web/src/components/auth/WalletLoginButton.tsx'
      via: 'E2E tests exercise the wallet login UI'
      pattern: 'wallet-login-button'
---

<objective>
Run wallet E2E tests and complete UAT verification for all auth + MFA flows

Purpose: Execute the wallet E2E tests created in Plan 02, verify the SecurityTab wiring from Plan 01 works at runtime, and document final UAT status for all 36 test cases. This is the quality gate before moving to Phase 12.1.

Output: Wallet E2E test results, updated UAT document with final statuses.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/debug/corekit-auth-uat.md
@.planning/phases/12.5-mfa-polishing-uat-e2e/12.5-01-SUMMARY.md
@.planning/phases/12.5-mfa-polishing-uat-e2e/12.5-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
<name>Task 1: Run wallet E2E tests and fix any issues</name>
<files>tests/e2e/tests/wallet-login.spec.ts</files>
<action>
Run the wallet E2E test suite:

```bash
cd /Users/michael/Code/cipher-box && pnpm --filter @cipherbox/e2e exec playwright test tests/wallet-login.spec.ts --reporter=list
```

If any tests fail due to implementation issues (not environment issues):

1. Diagnose the failure from the test output
2. Fix the test code or the application code as needed
3. Re-run until tests pass or failures are documented as environment-dependent

Expected outcomes:

- TC09 (happy path): May fail at Core Kit loginWithJWT step if Web3Auth devnet is unreachable. The SIWE UI flow (connect, sign) should work regardless. If it fails only at Core Kit, mark as "PASS (UI flow) / SKIP (Core Kit requires devnet)"
- TC10 (cancel): Should pass (pure UI interaction)
- TC11 (no wallet): Should pass (tests empty state)
- TC12 (error handling): Should pass (uses route interception to simulate error)

If tests reveal bugs in the wallet login flow, fix them in WalletLoginButton.tsx or the backend.
</action>
<verify>
Playwright test output shows results for all 4 test describe blocks.
No unexpected crashes or timeouts.
</verify>
<done>
All wallet E2E tests either pass or have documented skip reasons. Any bugs found are fixed and committed.
</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
<what-built>
1. SecurityTab wired into SettingsPage with tab navigation (Plan 01)
2. Wallet E2E tests with @johanneskares/wallet-mock (Plan 02)
3. Wallet E2E test results from Task 1
</what-built>
<how-to-verify>
SecurityTab verification (unblocks TC25-31):

1. Start frontend: `pnpm --filter web dev`
2. Start API: `pnpm --filter api dev`
3. Navigate to <http://localhost:5173>
4. Log in with email + OTP
5. Navigate to Settings (via user menu or direct URL /#/settings)
6. Verify two tabs visible: "LINKED METHODS" and "SECURITY"
7. Click "SECURITY" tab
8. Verify SecurityTab renders: MFA status badge ([DISABLED] or [ENABLED]), --enable-mfa button if disabled
9. Click "LINKED METHODS" tab - verify LinkedMethods component renders
10. Verify VaultExport section visible below tabs

Wallet E2E test results:
Review the test output from Task 1. Confirm:

- TC09: Mock wallet appears in connector list and SIWE flow initiates
- TC10: Cancel returns to initial state
- TC11: No-wallet state handled gracefully
- TC12: Error state shown and retry possible

If MFA enrollment is testable (SecurityTab is visible and working):

11. Click --enable-mfa button
12. Verify MFA enrollment wizard appears
13. Follow wizard steps (this tests TC25-26)
14. After enrollment, verify TC27-31 (authorized devices list, recovery phrase)
    </how-to-verify>
    <resume-signal>
    Type "approved" if SecurityTab and wallet E2E look good.
    Describe any issues found (broken tabs, visual glitches, test failures that need fixing).
    </resume-signal>
    </task>

<task type="auto">
<name>Task 3: Update UAT document with final statuses</name>
<files>.planning/debug/corekit-auth-uat.md</files>
<action>
Based on the checkpoint results, update `.planning/debug/corekit-auth-uat.md`:

1. Mark ISSUE-004 as RESOLVED (SecurityTab wired in Plan 01)
2. Update Status field at top: "COMPLETE -- All test cases have final status"
3. Update TC09-TC12 statuses based on wallet E2E test results
4. Update TC15-23 and TC25-31 statuses based on human verification
5. Add session log entry for this UAT session with date and results
6. Update the UAT Summary table with final counts

For any test cases that could not be run (e.g., TC16-20 requiring two devices):

- Status: SKIP
- Notes: Clear reason why (e.g., "Requires two authenticated devices/sessions")

For test cases that passed during manual verification:

- Status: PASS
- Notes: Brief description of what was verified

For test cases that revealed new bugs:

- Status: FAIL
- Notes: Bug description, create a new ISSUE entry
  </action>
  <verify>
  `grep "ISSUE-004" .planning/debug/corekit-auth-uat.md` shows "RESOLVED"
  All 36 test cases have a status (no blank status fields)
  </verify>
  <done>
  UAT document fully updated with final statuses for all 36 test cases. ISSUE-004 marked RESOLVED. Session log updated.
  </done>
  </task>

</tasks>

<verification>

- All wallet E2E tests have definitive results (pass or documented skip)
- SecurityTab is accessible from Settings page at runtime
- UAT document has final status for all 36 test cases
- No open issues without documentation

</verification>

<success_criteria>

- Wallet E2E tests demonstrate the mock wallet flow works (connector discovery, SIWE signing)
- SecurityTab is verified working at runtime by human
- All 36 UAT test cases have final status (PASS, SKIP with reason, FAIL with issue, or BLOCK with reason)
- ISSUE-004 marked as RESOLVED in UAT document
- Phase 12.5 quality gate passed

</success_criteria>

<output>
After completion, create `.planning/phases/12.5-mfa-polishing-uat-e2e/12.5-03-SUMMARY.md`
</output>
