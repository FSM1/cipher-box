---
phase: 10.1-v1-cleanup
plan: 01
subsystem: ui, api
tags: [react, nestjs, deprecated, dead-code, openapi, orval]

# Dependency graph
requires:
  - phase: 06.3-ui-structure-refactor
    provides: Deprecated FolderTree, FolderTreeNode, ApiStatusIndicator, Dashboard components
  - phase: 07.1-atomic-file-upload
    provides: /ipfs/upload endpoint that superseded /ipfs/add; fetchQuota that replaced addUsage
provides:
  - Clean codebase without deprecated components or dead endpoints
  - Regenerated API client reflecting only active endpoints
affects: []

# Tech tracking
tech-stack:
  added: []
  patterns: []

key-files:
  created: []
  modified:
    - apps/web/src/components/file-browser/index.ts
    - apps/web/src/routes/Login.tsx
    - apps/web/src/routes/Settings.tsx
    - apps/web/src/hooks/useAuth.ts
    - apps/web/src/hooks/useFolderNavigation.ts
    - apps/web/src/stores/quota.store.ts
    - apps/api/src/ipfs/ipfs.controller.ts
    - apps/api/src/ipfs/ipfs.controller.spec.ts
    - apps/api/src/ipfs/dto/index.ts
    - apps/api/test/ipfs.e2e-spec.ts
    - apps/web/src/api/ipfs/ipfs.ts
    - apps/web/src/api/models/index.ts
    - packages/api-client/openapi.json
    - tests/e2e/page-objects/file-browser/index.ts
    - tests/e2e/page-objects/index.ts

key-decisions:
  - 'Keep /dashboard redirect route in router for backward compatibility (bookmarks)'
  - "Update all navigate('/dashboard') calls to navigate('/files') for directness"
  - "Delete stale orval-generated model files manually since orval doesn't clean up removed endpoints"

patterns-established: []

# Metrics
duration: 7min
completed: 2026-02-11
---

# Phase 10.1 Plan 01: Dead Code and Deprecated Component Removal Summary

Removed 6 deprecated components, 1 dead API endpoint, 1 unused store method, and regenerated API client.

## Performance

- **Duration:** 7 min
- **Started:** 2026-02-11T03:14:41Z
- **Completed:** 2026-02-11T03:21:47Z
- **Tasks:** 2
- **Files deleted:** 8
- **Files modified:** 15

## Accomplishments

- Deleted FolderTree, FolderTreeNode, ApiStatusIndicator, Dashboard components and their E2E page objects
- Removed /ipfs/add endpoint (superseded by /ipfs/upload in Phase 7.1) with its DTO, unit tests, and E2E tests
- Removed unused addUsage method from quota store (replaced by server-authoritative fetchQuota)
- Regenerated OpenAPI spec and API client without dead endpoint types
- Updated all /dashboard navigation references to /files
- Both apps build clean, all 386 API tests pass

## Task Commits

Each task was committed atomically:

1. **Task 1: Remove deprecated frontend components and dead code** - `a41ae1d` (refactor) - committed in prior session
2. **Task 2: Remove /ipfs/add endpoint and regenerate API client** - `a4a28c1` (refactor)

## Files Deleted

- `apps/web/src/components/file-browser/FolderTree.tsx` - Deprecated sidebar folder tree
- `apps/web/src/components/file-browser/FolderTreeNode.tsx` - Recursive tree node component
- `apps/web/src/components/ApiStatusIndicator.tsx` - Old API status indicator (replaced by StatusIndicator)
- `apps/web/src/routes/Dashboard.tsx` - Old dashboard page (replaced by FilesPage with AppShell)
- `apps/api/src/ipfs/dto/add.dto.ts` - DTO for removed /ipfs/add endpoint
- `apps/web/src/api/models/addResponseDto.ts` - Generated model for removed endpoint
- `apps/web/src/api/models/ipfsControllerAddBody.ts` - Generated body type for removed endpoint
- `tests/e2e/page-objects/file-browser/folder-tree.page.ts` - E2E page object for FolderTree
- `tests/e2e/page-objects/dashboard.page.ts` - E2E page object for Dashboard

## Files Modified

- `apps/web/src/components/file-browser/index.ts` - Removed deprecated FolderTree/FolderTreeNode exports
- `apps/web/src/routes/Login.tsx` - Replaced ApiStatusIndicator with StatusIndicator, navigate to /files
- `apps/web/src/routes/Settings.tsx` - Changed "Back to Dashboard" to "Back to Files", navigate to /files
- `apps/web/src/hooks/useAuth.ts` - Post-login navigation changed from /dashboard to /files
- `apps/web/src/hooks/useFolderNavigation.ts` - Removed FolderTree reference from JSDoc example
- `apps/web/src/stores/quota.store.ts` - Removed unused addUsage method and type
- `apps/api/src/ipfs/ipfs.controller.ts` - Removed @Post('add') handler and AddResponseDto import
- `apps/api/src/ipfs/ipfs.controller.spec.ts` - Removed add() unit test describe block
- `apps/api/src/ipfs/dto/index.ts` - Removed AddResponseDto barrel export
- `apps/api/test/ipfs.e2e-spec.ts` - Removed /ipfs/add test block, updated unpin tests to use /ipfs/upload
- `apps/web/src/api/ipfs/ipfs.ts` - Regenerated without /ipfs/add hooks
- `apps/web/src/api/models/index.ts` - Removed stale addResponseDto and ipfsControllerAddBody exports
- `packages/api-client/openapi.json` - Regenerated without /ipfs/add path
- `tests/e2e/page-objects/file-browser/index.ts` - Removed FolderTreePage export
- `tests/e2e/page-objects/index.ts` - Removed FolderTreePage and DashboardPage exports

## Decisions Made

- **Keep /dashboard redirect route:** The `/dashboard` -> `/files` redirect in routes/index.tsx is kept for backward compatibility with bookmarks and cached URLs.
- **Update all navigation calls:** All `navigate('/dashboard')` calls in Login.tsx, Settings.tsx, and useAuth.ts updated to `navigate('/files')` for direct navigation without redirect.
- **Manual cleanup of generated models:** Orval does not automatically delete stale model files when endpoints are removed from the OpenAPI spec. Manually deleted `addResponseDto.ts` and `ipfsControllerAddBody.ts` and removed their barrel exports.
- **Delete DashboardPage E2E page object:** Though not listed in the plan, `tests/e2e/page-objects/dashboard.page.ts` referenced the deleted Dashboard route and folder-tree test IDs, making it dead code.

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Fixed E2E unpin tests using removed /ipfs/add endpoint**

- **Found during:** Task 2 (Remove /ipfs/add endpoint)
- **Issue:** The unpin E2E tests at lines 163-209 used `POST /ipfs/add` to set up test data, which no longer exists after removing the endpoint
- **Fix:** Changed the setup calls from `.post('/ipfs/add')` to `.post('/ipfs/upload')`
- **Files modified:** apps/api/test/ipfs.e2e-spec.ts
- **Verification:** Tests compile and structure is correct
- **Committed in:** a4a28c1 (Task 2 commit)

**2. [Rule 1 - Bug] Removed stale orval-generated model files**

- **Found during:** Task 2 (Regenerate API client)
- **Issue:** Orval regeneration created fresh ipfs.ts without /ipfs/add hooks, but left behind stale model files (addResponseDto.ts, ipfsControllerAddBody.ts) and their barrel exports
- **Fix:** Manually deleted stale model files and removed their exports from models/index.ts
- **Files modified:** apps/web/src/api/models/addResponseDto.ts (deleted), apps/web/src/api/models/ipfsControllerAddBody.ts (deleted), apps/web/src/api/models/index.ts
- **Verification:** `grep -r "AddResponseDto\|ipfsControllerAdd" apps/web/src/api/` returns zero hits
- **Committed in:** a4a28c1 (Task 2 commit)

**3. [Rule 1 - Bug] Removed add() unit tests from ipfs.controller.spec.ts**

- **Found during:** Task 2 (API tests failed after removing add endpoint)
- **Issue:** The controller unit test spec had a `describe('add', ...)` block with 3 tests that called `controller.add()` which no longer exists
- **Fix:** Removed the entire `describe('add', ...)` block (3 tests)
- **Files modified:** apps/api/src/ipfs/ipfs.controller.spec.ts
- **Verification:** All 386 API tests pass
- **Committed in:** a4a28c1 (Task 2 commit)

**4. [Rule 2 - Missing Critical] Deleted DashboardPage E2E page object**

- **Found during:** Task 1 (searching for remaining Dashboard references)
- **Issue:** `tests/e2e/page-objects/dashboard.page.ts` referenced the deleted Dashboard route (/dashboard) and folder-tree test IDs
- **Fix:** Deleted the file and removed its barrel export from tests/e2e/page-objects/index.ts
- **Files modified:** tests/e2e/page-objects/dashboard.page.ts (deleted), tests/e2e/page-objects/index.ts
- **Verification:** No remaining references to DashboardPage in test codebase
- **Committed in:** a41ae1d (Task 1 commit)

**5. [Rule 2 - Missing Critical] Updated /dashboard navigation to /files**

- **Found during:** Task 1 (scanning Dashboard references)
- **Issue:** Login.tsx, useAuth.ts, and Settings.tsx navigated to /dashboard which is now just a redirect to /files
- **Fix:** Updated all three to navigate directly to /files; changed Settings button text from "Back to Dashboard" to "Back to Files"
- **Files modified:** apps/web/src/routes/Login.tsx, apps/web/src/hooks/useAuth.ts, apps/web/src/routes/Settings.tsx
- **Verification:** Web app builds clean
- **Committed in:** a41ae1d (Task 1 commit)

---

**Total deviations:** 5 auto-fixed (3 bugs, 2 missing critical)
**Impact on plan:** All auto-fixes necessary for correctness after removals. No scope creep.

## Issues Encountered

None - all removals were straightforward. The only surprises were stale generated files and test references to the removed endpoint, both handled by deviation rules.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- Codebase is leaner with zero deprecated components
- Ready for Plan 10.1-02 (documentation updates) and Plan 10.1-03 (E2E test cleanup)
- No blockers or concerns

---

_Phase: 10.1-v1-cleanup_
_Completed: 2026-02-11_
