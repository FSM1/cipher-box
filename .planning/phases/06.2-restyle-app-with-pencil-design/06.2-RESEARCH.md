# Phase 6.2: Restyle App with Pencil Design - Research

**Researched:** 2026-01-23
**Domain:** React UI Styling, Design System Implementation
**Confidence:** HIGH

## Summary

This research investigated how to restyle the CipherBox web application using the Pencil design specifications to create a terminal/hacker aesthetic with dark mode and JetBrains Mono typography. The existing codebase uses React with global CSS files (not CSS Modules), organized by component/feature area. The design file (`designs/cipher-box-design.pen`) is a JSON document containing complete specifications for colors (#00D084 green on #000000 black), typography (JetBrains Mono font family), spacing, and layout structures.

The standard approach for this restyle involves: (1) Loading JetBrains Mono from Google Fonts CDN, (2) Implementing CSS custom properties (design tokens) for colors and spacing in `:root`, (3) Updating existing global CSS files to match Pencil design specifications, and (4) Optionally implementing a lightweight Canvas-based matrix rain effect for the login background.

**Primary recommendation:** Maintain the existing global CSS architecture (files organized by feature), implement design tokens using CSS custom properties, and systematically update styles to match exact specifications extracted from the Pencil design JSON.

## Standard Stack

The established libraries/tools for this domain:

### Core
| Library | Version | Purpose | Why Standard |
|---------|---------|---------|--------------|
| React | ^18.3.1 | UI framework | Already in use, component structure is sound |
| Vite | ^7.3.0 | Build tool | Already configured, supports CSS imports |
| Google Fonts CDN | N/A | JetBrains Mono delivery | Industry standard for web font loading, reliable CDN |

### Supporting
| Library | Version | Purpose | When to Use |
|---------|---------|---------|-------------|
| @floating-ui/react | ^0.27.16 | Context menu positioning | Already in use for modals/menus |

### Alternatives Considered
| Instead of | Could Use | Tradeoff |
|------------|-----------|----------|
| Global CSS | CSS Modules (.module.css) | CSS Modules provide better scoping but require refactoring 95 TypeScript files; global CSS with BEM naming is working well |
| Google Fonts CDN | Self-hosted fonts | Self-hosting provides more control but adds complexity; CDN is simpler for single-font case |
| Canvas animation | CSS-only matrix | Canvas provides better performance and more control; pure CSS can be used as fallback |

**Installation:**
No new dependencies required. JetBrains Mono loads via CDN link in HTML.

## Architecture Patterns

### Recommended Project Structure (Current)
```
apps/web/src/
├── styles/                    # Feature-specific global CSS
│   ├── file-browser.css      # File browser components
│   ├── breadcrumbs.css       # Breadcrumb navigation
│   ├── context-menu.css      # Context menus
│   ├── dialogs.css           # Dialog components
│   ├── modal.css             # Modal overlays
│   ├── upload.css            # Upload-related UI
│   └── responsive.css        # Mobile/tablet breakpoints
├── index.css                 # Global resets, design tokens
├── App.css                   # App-level layouts
└── components/               # React components (TSX files)
```

**Keep this structure.** The existing organization by feature area is maintainable and appropriate.

### Pattern 1: Design Tokens with CSS Custom Properties

**What:** Define design system values as CSS variables in `:root` selector
**When to use:** Always, for all colors, spacing, typography, and other design primitives

**Example:**
```css
/* index.css - Design Tokens */
:root {
  /* Color Primitives */
  --color-black: #000000;
  --color-green-primary: #00D084;
  --color-green-dim: #006644;
  --color-green-darker: #003322;
  --color-green-glow: #00D08466; /* 40% opacity for shadows */

  /* Semantic Colors */
  --color-background: var(--color-black);
  --color-border: var(--color-green-primary);
  --color-text-primary: var(--color-green-primary);
  --color-text-secondary: var(--color-green-dim);
  --color-accent: var(--color-green-primary);

  /* Typography */
  --font-family-mono: "JetBrains Mono", monospace;
  --font-size-xs: 10px;   /* Status text */
  --font-size-sm: 11px;   /* Body, buttons, headers */
  --font-size-md: 14px;   /* App name */
  --font-size-lg: 18px;   /* Prompt symbol */
  --font-size-xl: 24px;   /* Login logo */

  /* Spacing (from design file) */
  --spacing-xs: 8px;
  --spacing-sm: 12px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;

  /* Effects */
  --glow-green: 0 0 10px var(--color-green-glow);
  --border-thickness: 1px;
}
```

**Source:** [Penpot - Design Tokens Guide](https://penpot.app/blog/the-developers-guide-to-design-tokens-and-css-variables/), [Smashing Magazine - Naming Best Practices](https://www.smashingmagazine.com/2024/05/naming-best-practices/)

### Pattern 2: Component Style Updates

**What:** Update existing CSS files to use design tokens and match Pencil specs
**When to use:** For every component needing restyle

**Example:**
```css
/* file-browser.css - Before */
.file-browser-sidebar {
  width: 250px;
  border-right: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(0, 0, 0, 0.2);
}

/* file-browser.css - After */
.file-browser-sidebar {
  width: 250px;
  border-right: var(--border-thickness) solid var(--color-border);
  background: var(--color-background);
}
```

### Pattern 3: Terminal-Style Buttons

**What:** Buttons styled as command-line flags with green text/borders
**When to use:** All action buttons (upload, new folder, refresh)

**Example from design file:**
```css
/* Filled button (primary action) */
.btn-primary {
  padding: var(--spacing-xs) var(--spacing-md);
  background: var(--color-green-primary);
  color: var(--color-black);
  border: none;
  font-family: var(--font-family-mono);
  font-size: var(--font-size-sm);
  font-weight: 600;
}

/* Outlined button (secondary action) */
.btn-secondary {
  padding: var(--spacing-xs) var(--spacing-md);
  background: transparent;
  color: var(--color-green-primary);
  border: var(--border-thickness) solid var(--color-border);
  font-family: var(--font-family-mono);
  font-size: var(--font-size-sm);
  font-weight: normal;
}
```

**From Pencil design:** Buttons show `--upload`, `--new-dir`, `--refresh` as text content.

### Pattern 4: Matrix Background Effect (Login)

**What:** Canvas-based falling character animation for login screen background
**When to use:** Login page only, as subtle background effect

**Example architecture:**
```typescript
// MatrixBackground.tsx
import { useEffect, useRef } from 'react';

export function MatrixBackground() {
  const canvasRef = useRef<HTMLCanvasElement>(null);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    // Set canvas size to window
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Matrix rain implementation
    const columns = Math.floor(canvas.width / 20);
    const drops: number[] = Array(columns).fill(1);

    function draw() {
      // Semi-transparent black to create trail effect
      ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.fillStyle = '#00D084';
      ctx.font = '15px JetBrains Mono';

      for (let i = 0; i < drops.length; i++) {
        const char = Math.random() > 0.5 ? '1' : '0';
        ctx.fillText(char, i * 20, drops[i] * 20);

        if (drops[i] * 20 > canvas.height && Math.random() > 0.975) {
          drops[i] = 0;
        }
        drops[i]++;
      }
    }

    const interval = setInterval(draw, 33); // ~30fps
    return () => clearInterval(interval);
  }, []);

  return <canvas ref={canvasRef} className="matrix-background" />;
}
```

**CSS:**
```css
.matrix-background {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  opacity: 0.3; /* Subtle, not overwhelming */
}
```

**Source:** [Matrix Rain Effect Blog](https://www.maartenhus.nl/blog/matrix-rain-effect/), [React Matrix Rain GitHub](https://github.com/FullStackWithLawrence/react-mdr)

### Pattern 5: Typography Loading

**What:** Load JetBrains Mono from Google Fonts with proper preconnect
**When to use:** In HTML head, before any styles

**Example:**
```html
<!-- apps/web/index.html -->
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Preconnect to Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <!-- Load JetBrains Mono -->
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">

  <title>CipherBox</title>
</head>
```

**Weights needed:**
- 400 (normal) - body text, breadcrumbs, user email
- 600 (semibold) - app name, column headers, button text
- 700 (bold) - prompt symbol `>`

**Source:** [Google Fonts - JetBrains Mono](https://fonts.google.com/specimen/JetBrains+Mono)

### Anti-Patterns to Avoid

- **Mixing font families:** Design specifies JetBrains Mono exclusively. Do not use system fonts or fallbacks except in font-family declaration.
- **Hardcoding colors:** Always use CSS variables, never hex codes directly in component styles.
- **Light mode styles:** Remove or comment out light mode CSS variables and `@media (prefers-color-scheme: light)` queries. Design is dark-only.
- **Emoji icons:** Design uses `[DIR]` and `[FILE]` text prefixes, not emoji. Replace emoji icons with text labels.
- **Rounded corners:** Design uses sharp corners (0px border-radius) for terminal aesthetic. Remove existing border-radius values.

## Don't Hand-Roll

Problems that look simple but have existing solutions:

| Problem | Don't Build | Use Instead | Why |
|---------|-------------|-------------|-----|
| Responsive breakpoints | Custom media queries everywhere | Centralized responsive.css with standard breakpoints | Industry standard breakpoints (768px, 1024px) prevent inconsistency |
| Font loading optimization | Manual font file management | Google Fonts CDN with preconnect | CDN handles browser-specific formats, caching, and performance |
| Context menu positioning | Manual coordinate calculation | @floating-ui/react (already in use) | Edge detection, viewport constraints already implemented |
| Color opacity variations | Manual rgba() calculations | CSS custom properties with hex + opacity suffix | Design file already specifies `#00D08466` format |

**Key insight:** This is a restyle, not a rebuild. Leverage existing component structure and only change visual styles. The architecture (React components, hooks, stores) remains unchanged.

## Common Pitfalls

### Pitfall 1: Inconsistent Spacing Values

**What goes wrong:** Using arbitrary padding/margin values like `padding: 10px` or `margin: 15px` that don't match design specs.

**Why it happens:** Developers eyeball spacing instead of extracting exact values from design file.

**How to avoid:**
- Extract all spacing values from Pencil design JSON (found: 8px, 10px, 12px, 16px, 20px, 24px, 32px)
- Define design tokens for each value
- Use only tokenized spacing in CSS

**Warning signs:**
- Spacing doesn't look "quite right" when compared to design
- Inconsistent gaps between elements on different pages

### Pitfall 2: Font Weight Mismatches

**What goes wrong:** Using wrong font weights (e.g., 500 instead of 600) causes text to not match design.

**Why it happens:** Generic understanding of "bold" vs specific weight numbers in design.

**How to avoid:**
- Load exact weights from Google Fonts: 400, 600, 700
- Map design specs to CSS: normal = 400, semibold = 600, bold = 700
- Verify font-weight values match design JSON

**Warning signs:**
- Text looks "too bold" or "too light" compared to design
- Status text, headers, or buttons don't have proper visual hierarchy

### Pitfall 3: Responsive Breakpoint Chaos

**What goes wrong:** Mobile layout breaks because existing responsive.css conflicts with new styles.

**Why it happens:** Updating desktop styles without checking responsive overrides.

**How to avoid:**
- Update both desktop AND mobile breakpoints in responsive.css
- Test at 390px (mobile design spec) and 1440px (desktop design spec)
- Maintain existing 768px breakpoint logic

**Warning signs:**
- Sidebar doesn't slide in on mobile
- File list columns overlap on small screens
- Text truncates unexpectedly

### Pitfall 4: Color Opacity Format Confusion

**What goes wrong:** Mixing rgba() with hex+alpha formats causes inconsistent transparency.

**Why it happens:** Design file uses hex with alpha suffix (`#00D08466`) but developers use rgba().

**How to avoid:**
- Extract exact color values including alpha from design JSON
- Define tokens with proper format: `--color-green-glow: #00D08466;`
- Use modern CSS: `color: #00D08466;` is valid in all modern browsers

**Warning signs:**
- Glow effects look wrong
- Shadow opacity doesn't match design
- Hover states too opaque or transparent

### Pitfall 5: Over-Engineering the Matrix Effect

**What goes wrong:** Matrix background animation causes performance issues or complexity.

**Why it happens:** Trying to make it "perfect" instead of "subtle and performant".

**How to avoid:**
- Keep implementation under 100 lines as recommended
- Use `requestAnimationFrame` with throttling, not setInterval
- Set low opacity (0.2-0.3) so it's ambient, not distracting
- Consider skipping animation if complexity > expected benefit (user decision per CONTEXT)

**Warning signs:**
- Login page has noticeable lag
- Animation draws attention away from login button
- Canvas code exceeds 150 lines

### Pitfall 6: Icon Replacement Mistakes

**What goes wrong:** Replacing emoji icons with `[DIR]`/`[FILE]` text breaks alignment or looks wrong.

**Why it happens:** Text content has different sizing/spacing than emoji.

**How to avoid:**
- Use same font-family (JetBrains Mono) for icon prefixes
- Keep spacing consistent with design: 8px gap between prefix and name
- Maintain existing flex alignment in FileListItem

**Warning signs:**
- File/folder names misaligned
- Icon text looks cramped or too spaced
- Mobile list items have layout issues

## Code Examples

Verified patterns from official sources:

### Loading Web Fonts (Google Fonts)
```html
<!-- Source: https://fonts.google.com/specimen/JetBrains+Mono -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet">
```

### CSS Design Tokens Pattern
```css
/* Source: Smashing Magazine - Naming Best Practices */
:root {
  /* Primitive tokens */
  --color-black: #000000;
  --color-green-500: #00D084;

  /* Semantic tokens */
  --color-background: var(--color-black);
  --color-primary: var(--color-green-500);

  /* Component tokens */
  --button-bg-primary: var(--color-primary);
  --button-text-primary: var(--color-background);
}
```

### Responsive Breakpoint Structure
```css
/* Source: BrowserStack - Responsive Design Breakpoints */
/* Mobile-first base styles */
.component {
  padding: 12px;
  font-size: 14px;
}

/* Tablet (768px+) */
@media (min-width: 768px) {
  .component {
    padding: 16px;
  }
}

/* Desktop (1024px+) */
@media (min-width: 1024px) {
  .component {
    padding: 24px;
    font-size: 16px;
  }
}
```

### Matrix Rain Canvas Effect
```typescript
// Source: https://www.maartenhus.nl/blog/matrix-rain-effect/
// Simplified for clarity
function draw(ctx: CanvasRenderingContext2D, drops: number[]) {
  // Fade previous frame
  ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
  ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);

  // Draw new characters
  ctx.fillStyle = '#00D084';
  ctx.font = '15px JetBrains Mono';

  drops.forEach((y, x) => {
    const char = Math.random() > 0.5 ? '1' : '0';
    ctx.fillText(char, x * 20, y * 20);

    // Reset drop when it reaches bottom
    if (y * 20 > ctx.canvas.height && Math.random() > 0.975) {
      drops[x] = 0;
    }
    drops[x]++;
  });
}
```

## Design File Specifications

### Extracted from `designs/cipher-box-design.pen`

**Colors (from JSON):**
- Background: `#000000` (pure black)
- Primary accent: `#00D084` (green)
- Secondary text: `#006644` (dim green)
- Row dividers: `#003322` (darker green)
- Glow effect: `#00D08466` (green with 40% opacity)

**Typography (from JSON):**
- Font family: `"JetBrains Mono"` (all text)
- Font sizes: 10px (status), 11px (body/buttons/headers), 14px (app name), 18px (prompt), 24px (login logo)
- Font weights: 400 (normal), 600 (semibold), 700 (bold)

**Spacing (from JSON):**
- Padding values: 8px, 10px, 12px, 16px, 24px
- Gaps: 8px, 12px, 16px, 20px, 32px
- Border thickness: 1px (standard), 2px (logo outer), 1.5px (logo middle)

**Layout (from JSON):**
- Desktop frame: 1440px × 900px
- Mobile frame: 390px × 844px
- File list columns: Name (flex), Size (120px), Type (120px), Modified (180px)
- Header height: auto (content-based with 12px vertical padding)

**Component Inventory from Design:**

Desktop File Browser (`bi8Au`):
- Header with logo (`> CIPHERBOX`), status indicator, user email
- Breadcrumb bar showing path (`~/storage/documents/projects`)
- Action buttons: `--upload` (filled green), `--new-dir` (outlined), `--refresh` (outlined)
- File list table with green borders, column headers (NAME, SIZE, TYPE, MODIFIED)
- File rows with `[DIR]` and `[FILE]` prefixes

Mobile File Browser (`ZVAUX`):
- Same structure, adapted for 390px width
- Columns reduced (likely hide TYPE and MODIFIED per existing responsive.css)

Login Desktop (`gVNOQ`):
- Centered logo (nested green squares with glow effect)
- `> CIPHERBOX` branding
- `[CONNECT]` button (green filled)
- Connection status text
- Matrix background (implied, to be added)

Login Mobile (`3OkP2`, `77MPO`, `j6TYH`):
- Same login structure, mobile width (390px)
- Connected vs disconnected states

## State of the Art

| Old Approach | Current Approach | When Changed | Impact |
|--------------|------------------|--------------|--------|
| System fonts (Inter, Arial, Helvetica) | Monospace fonts (JetBrains Mono) for entire UI | 2024-2025 trend | Creates distinct terminal aesthetic, improves code/data readability |
| CSS preprocessors (Sass, Less) | CSS custom properties (native variables) | 2020+ | Browser support now universal, no build step needed for variables |
| Fixed breakpoints | Content-based breakpoints | 2023+ | Focus on where layout breaks, not device sizes; still use standard ranges |
| Light mode default | Dark mode default/only | 2024+ (for dev tools) | Reduces eye strain for technical users, aligns with terminal UX |
| Rounded UI elements | Sharp corners (border-radius: 0) | 2025 terminal aesthetic | Evokes retro computing, technical precision |

**Deprecated/outdated:**
- **CSS Modules in this codebase:** Considered but not used; global CSS with BEM-style naming works well for current scale (95 files)
- **Light mode support:** Design explicitly excludes light mode; remove `@media (prefers-color-scheme: light)` blocks
- **Emoji as file type icons:** Design uses text labels `[DIR]`/`[FILE]` instead
- **Color gradients:** Design uses flat colors only; remove any gradient backgrounds (login button currently has gradient)

## Open Questions

Things that couldn't be fully resolved:

1. **Matrix animation implementation complexity** — **RESOLVED: Use full animation**
   - What we know: Canvas-based approach is standard, ~100 lines recommended
   - Decision: User confirmed full animated matrix rain effect (not static)
   - Implementation: Canvas-based, ~30fps, requestAnimationFrame, low opacity (0.25)

2. **Mobile column visibility** — **RESOLVED: Use 2-row stacked layout**
   - What we know: Desktop shows 4 columns (NAME, SIZE, TYPE, MODIFIED)
   - Decision: Mobile uses 2-row stacked layout per Pencil design (node ZVAUX)
     - Row 1: [DIR]/[FILE] icon + filename (left aligned)
     - Row 2: Modified date (left) | Size (right) — space-between
   - Implementation: Change mobile CSS from grid columns to vertical flex layout

3. **Error/warning colors**
   - What we know: CONTEXT.md mentions "add red for errors, yellow for warnings"
   - What's unclear: Exact shades (which red, which yellow)
   - Recommendation: Use semantic red (#EF4444) and yellow (#F59E0B) from existing dialogs.css, or ask user for preference

4. **Settings page design**
   - What we know: Explicitly deferred until user creates Pencil design
   - What's unclear: N/A
   - Recommendation: Skip settings page entirely in this phase

5. **Hover/focus state glow effect**
   - What we know: CONTEXT mentions "subtle green glow effect on interactive elements"
   - What's unclear: Exact glow parameters (blur radius, opacity, spread)
   - Recommendation: Use existing shadow effect from design JSON: `blur: 10px`, `color: #00D08466`

## Sources

### Primary (HIGH confidence)
- Design file: `designs/cipher-box-design.pen` (JSON format) - exact color, typography, spacing specifications
- Google Fonts: [JetBrains Mono](https://fonts.google.com/specimen/JetBrains+Mono) - font loading and weights
- Existing codebase: 95 TypeScript files, 9 CSS files - current architecture and patterns

### Secondary (MEDIUM confidence)
- [React & CSS in 2026: Best Styling Approaches](https://medium.com/@imranmsa93/react-css-in-2026-best-styling-approaches-compared-d5e99a771753) - CSS Modules vs global CSS
- [Smashing Magazine - Naming Best Practices](https://www.smashingmagazine.com/2024/05/naming-best-practices/) - design token naming conventions
- [Penpot - Design Tokens Guide](https://penpot.app/blog/the-developers-guide-to-design-tokens-and-css-variables/) - CSS variables structure
- [BrowserStack - Responsive Design Breakpoints](https://www.browserstack.com/guide/responsive-design-breakpoints) - standard breakpoint values
- [Matrix Rain Effect Blog](https://www.maartenhus.nl/blog/matrix-rain-effect/) - canvas animation implementation

### Tertiary (LOW confidence)
- WebSearch results on CSS theming patterns - general guidance, not CipherBox-specific
- WebSearch results on matrix effects - multiple approaches, need to select simplest

## Metadata

**Confidence breakdown:**
- Standard stack: HIGH - Existing dependencies verified, no new packages needed
- Architecture: HIGH - Design file extracted, existing CSS structure analyzed
- Pitfalls: HIGH - Based on common CSS/responsive issues and design file specifics
- Design tokens: HIGH - Exact values extracted from JSON
- Matrix animation: MEDIUM - Multiple implementation options, user preference unclear

**Research date:** 2026-01-23
**Valid until:** 2026-02-23 (30 days - stable technologies, finalized design)
