---
phase: 06.2-restyle-app-pencil-design
plan: 04
type: execute
wave: 2
depends_on: ["06.2-01"]
files_modified:
  - apps/web/src/styles/responsive.css
  - apps/web/src/components/MatrixBackground.tsx
  - apps/web/src/routes/Login.tsx
autonomous: true

must_haves:
  truths:
    - "Mobile layout uses green color scheme"
    - "Mobile file list uses 2-row stacked layout (icon+name / date+size)"
    - "Sidebar overlay has terminal styling on mobile"
    - "Login page shows FULL matrix animation in background"
    - "Matrix effect is performant (30fps, low opacity)"
  artifacts:
    - path: "apps/web/src/styles/responsive.css"
      provides: "Mobile responsive styles with terminal aesthetic"
      contains: "var(--color-green-primary)"
    - path: "apps/web/src/components/MatrixBackground.tsx"
      provides: "Canvas-based matrix rain animation"
      min_lines: 50
      contains: "canvas"
  key_links:
    - from: "apps/web/src/routes/Login.tsx"
      to: "apps/web/src/components/MatrixBackground.tsx"
      via: "component import and render"
      pattern: "import.*MatrixBackground"
---

<objective>
Update responsive styles for mobile and add FULL matrix background animation to login page.

Purpose: Mobile users need the same terminal aesthetic, and the login page needs the signature matrix rain effect for visual appeal. Per user decision: implement the full animated matrix rain effect (not static fallback). The animation should be subtle and performant.

Output: Terminal-styled responsive layout and animated matrix background on login.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06.2-restyle-app-with-pencil-design/06.2-CONTEXT.md
@.planning/phases/06.2-restyle-app-with-pencil-design/06.2-RESEARCH.md
@.planning/phases/06.2-restyle-app-with-pencil-design/06.2-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update responsive.css with terminal aesthetic</name>
  <files>apps/web/src/styles/responsive.css</files>
  <action>
Replace the entire responsive.css with terminal-styled version using design tokens.

```css
/**
 * Responsive Styles - Terminal Aesthetic
 *
 * Mobile-first responsive design for the file browser.
 * Breakpoint: 768px (tablet/desktop boundary)
 *
 * Mobile features:
 * - Sidebar slides in as overlay
 * - Hamburger toggle in toolbar
 * - Backdrop behind sidebar
 * - Touch-friendly sizing
 */

/* ==========================================================================
   Mobile Hamburger Toggle
   ========================================================================== */

.file-browser-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2.5rem;
  height: 2.5rem;
  padding: 0;
  background: transparent;
  border: var(--border-thickness) solid var(--color-border);
  border-radius: 0;
  color: var(--color-text-primary);
  font-size: 1.25rem;
  cursor: pointer;
  transition: background-color 0.15s ease, box-shadow 0.15s ease;
  flex-shrink: 0;
}

.file-browser-toggle:hover {
  background-color: var(--color-green-darker);
  box-shadow: var(--glow-green);
}

.file-browser-toggle:focus {
  outline: 2px solid var(--color-green-primary);
  outline-offset: 2px;
}

/* ==========================================================================
   Mobile Sidebar Overlay
   ========================================================================== */

/* Backdrop when sidebar is open */
.file-browser-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  z-index: 99;
  animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

/* Sidebar close button (mobile) */
.file-browser-sidebar-close {
  position: absolute;
  top: var(--spacing-sm);
  right: var(--spacing-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 2rem;
  height: 2rem;
  padding: 0;
  background: transparent;
  border: var(--border-thickness) solid var(--color-border);
  border-radius: 0;
  color: var(--color-text-secondary);
  font-size: 1.25rem;
  cursor: pointer;
  transition: color 0.15s ease, background-color 0.15s ease;
  z-index: 1;
}

.file-browser-sidebar-close:hover {
  color: var(--color-text-primary);
  background-color: var(--color-green-darker);
}

/* ==========================================================================
   Mobile Layout Overrides
   ========================================================================== */

@media (max-width: 768px) {
  /* Sidebar: fixed position overlay */
  .file-browser-sidebar {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 280px;
    max-width: 85vw;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: 100;
    background-color: var(--color-background);
    border-right: var(--border-thickness) solid var(--color-border);
    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
  }

  .file-browser-sidebar--open {
    transform: translateX(0);
  }

  .file-browser-sidebar--closed {
    transform: translateX(-100%);
  }

  /* Adjust folder tree header for close button */
  .folder-tree-header {
    padding-right: 3rem;
  }

  /* Main content: full width */
  .file-browser-main {
    padding: var(--spacing-sm);
  }

  /* Toolbar: add gap for hamburger */
  .file-browser-toolbar {
    gap: var(--spacing-xs);
    flex-wrap: wrap;
  }

  /* File list: hide header on mobile (2-row item layout) */
  .file-list-header {
    display: none;
  }

  /* File list items: 2-row stacked layout per Pencil design */
  .file-list-item {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 10px 12px;
    min-height: auto;
  }

  /* Row 1: Icon + Name (left aligned) */
  .file-list-item-row-top {
    display: flex;
    align-items: center;
    gap: 6px;
    width: 100%;
  }

  .file-list-item-icon {
    font-size: 10px;
    font-weight: 600;
  }

  .file-list-item-name {
    font-size: 11px;
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  /* Row 2: Modified (left) | Size (right) - space-between */
  .file-list-item-row-bottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
    width: 100%;
  }

  .file-list-item-date,
  .file-list-item-size {
    font-size: 9px;
    color: var(--color-text-secondary);
  }

  /* Hide TYPE column on mobile (shown in row layout via icon) */
  .file-list-item-type {
    display: none;
  }

  /* Empty state: smaller margins */
  .empty-state {
    margin: var(--spacing-md);
    min-height: 200px;
  }

  /* Context menu: touch-friendly */
  .context-menu {
    min-width: 200px;
  }

  .context-menu-item {
    padding: var(--spacing-sm) var(--spacing-md);
    font-size: var(--font-size-sm);
  }

  /* Dialogs: full width on small screens */
  .modal-container {
    max-width: calc(100vw - 2rem);
    margin: var(--spacing-md);
  }

  /* Login: adjust spacing */
  .login-container {
    padding: var(--spacing-md);
  }

  .login-container h1 {
    font-size: 1.5rem;
  }
}

/* ==========================================================================
   Desktop Layout (default)
   ========================================================================== */

@media (min-width: 769px) {
  /* Sidebar always visible on desktop */
  .file-browser-sidebar {
    position: relative;
    transform: none;
  }

  .file-browser-sidebar--open,
  .file-browser-sidebar--closed {
    transform: none;
  }

  /* Hide mobile-only elements */
  .file-browser-toggle,
  .file-browser-backdrop,
  .file-browser-sidebar-close {
    display: none;
  }
}

/* ==========================================================================
   Touch Interactions
   ========================================================================== */

/* Prevent text selection during long-press */
.file-list-item {
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
}

/* Visual feedback for touch */
@media (pointer: coarse) {
  .file-list-item:active {
    background-color: var(--color-green-darker);
  }

  .folder-tree-item:active {
    background-color: var(--color-green-darker);
  }
}
```

Key changes:
- Replace all rgba colors with design token variables
- Remove border-radius values
- Use green color scheme for all hover/active states
- Update file list to hide TYPE column on mobile (2 columns: NAME, SIZE)
  </action>
  <verify>Check file contains `var(--color-green-primary)` and `var(--color-green-darker)`</verify>
  <done>Responsive styles use terminal aesthetic with green color scheme on mobile</done>
</task>

<task type="auto">
  <name>Task 2: Create MatrixBackground component</name>
  <files>apps/web/src/components/MatrixBackground.tsx</files>
  <action>
Create a new file `apps/web/src/components/MatrixBackground.tsx` with the matrix rain animation.

```tsx
import { useEffect, useRef } from 'react';

/**
 * Matrix rain background effect for login page.
 * Canvas-based animation with falling binary/hex characters.
 * Performance-optimized: 30fps, low opacity, resize handling.
 */
export function MatrixBackground() {
  const canvasRef = useRef<HTMLCanvasElement>(null);
  const animationRef = useRef<number>(0);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    // Configuration
    const FONT_SIZE = 14;
    const COLUMN_WIDTH = 20;
    const FRAME_INTERVAL = 33; // ~30fps
    const CHARACTERS = '01';
    const PRIMARY_COLOR = '#00D084';
    const DIM_COLOR = '#006644';

    // State
    let columns: number[] = [];
    let lastFrameTime = 0;

    // Resize handler
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      // Initialize/reset columns
      const columnCount = Math.floor(canvas.width / COLUMN_WIDTH);
      columns = Array(columnCount).fill(0).map(() =>
        Math.random() * -100 // Start at random positions above viewport
      );
    }

    // Draw frame
    function draw(timestamp: number) {
      // Throttle to ~30fps
      if (timestamp - lastFrameTime < FRAME_INTERVAL) {
        animationRef.current = requestAnimationFrame(draw);
        return;
      }
      lastFrameTime = timestamp;

      // Fade previous frame (creates trail effect)
      ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw characters
      ctx.font = `${FONT_SIZE}px "JetBrains Mono", monospace`;

      for (let i = 0; i < columns.length; i++) {
        const y = columns[i] * FONT_SIZE;

        // Random character
        const char = CHARACTERS[Math.floor(Math.random() * CHARACTERS.length)];

        // Leading character is brighter
        ctx.fillStyle = PRIMARY_COLOR;
        ctx.fillText(char, i * COLUMN_WIDTH, y);

        // Trail characters are dimmer
        if (Math.random() > 0.98) {
          ctx.fillStyle = DIM_COLOR;
          ctx.fillText(char, i * COLUMN_WIDTH, y - FONT_SIZE);
        }

        // Move column down
        columns[i]++;

        // Reset when reaching bottom (with random chance for variation)
        if (y > canvas.height && Math.random() > 0.975) {
          columns[i] = 0;
        }
      }

      animationRef.current = requestAnimationFrame(draw);
    }

    // Initialize
    resize();
    window.addEventListener('resize', resize);
    animationRef.current = requestAnimationFrame(draw);

    // Cleanup
    return () => {
      window.removeEventListener('resize', resize);
      cancelAnimationFrame(animationRef.current);
    };
  }, []);

  return (
    <canvas
      ref={canvasRef}
      className="matrix-background"
      aria-hidden="true"
      style={{
        position: 'fixed',
        top: 0,
        left: 0,
        width: '100%',
        height: '100%',
        zIndex: -1,
        opacity: 0.25, // Subtle, not overwhelming
        pointerEvents: 'none',
      }}
    />
  );
}
```

Key implementation details:
- Uses requestAnimationFrame for smooth animation
- Throttled to ~30fps to reduce CPU usage
- Low opacity (0.25) for subtle effect
- Handles window resize
- Cleanup on unmount
- Uses JetBrains Mono font for consistency
- aria-hidden for accessibility
  </action>
  <verify>Check file exists and contains `requestAnimationFrame` and `JetBrains Mono`</verify>
  <done>MatrixBackground component created with performant canvas animation</done>
</task>

<task type="auto">
  <name>Task 3: Add MatrixBackground to Login page</name>
  <files>apps/web/src/routes/Login.tsx</files>
  <action>
Update Login.tsx to import and render the MatrixBackground component.

```tsx
import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ApiStatusIndicator } from '../components/ApiStatusIndicator';
import { AuthButton } from '../components/auth/AuthButton';
import { MatrixBackground } from '../components/MatrixBackground';
import { useAuth } from '../hooks/useAuth';

/**
 * Login page with terminal aesthetic and matrix background.
 * Per design: > CIPHERBOX branding, [CONNECT] button, green-on-black theme.
 */
export function Login() {
  const { isAuthenticated, isLoading } = useAuth();
  const navigate = useNavigate();

  // Redirect if already authenticated
  useEffect(() => {
    if (isAuthenticated) {
      navigate('/dashboard');
    }
  }, [isAuthenticated, navigate]);

  // Show loading state while checking authentication
  if (isLoading) {
    return (
      <div className="login-container">
        <MatrixBackground />
        <div className="loading">initializing...</div>
      </div>
    );
  }

  return (
    <div className="login-container">
      <MatrixBackground />
      <h1>CIPHERBOX</h1>
      <p className="tagline">zero-knowledge encrypted storage</p>
      <p className="login-description">
        your files, encrypted on your device. we never see your data.
      </p>
      <AuthButton />
      <ApiStatusIndicator />
    </div>
  );
}
```

Key changes:
- Import MatrixBackground component
- Render MatrixBackground as first child in login-container
- Update text to lowercase for terminal aesthetic
- Update tagline text to match design
- Loading state shows "initializing..." instead of "Loading..."
  </action>
  <verify>Run `pnpm --filter web dev` and verify login page shows matrix animation in background</verify>
  <done>Login page displays matrix rain animation behind content</done>
</task>

</tasks>

<verification>
1. Open app on mobile viewport (390px width)
   - Sidebar should slide in from left with green border
   - File list should show 2 columns (NAME, SIZE)
   - Touch interactions should show green highlights
2. Open login page
   - Matrix animation visible in background (subtle, not distracting)
   - Animation runs smoothly (~30fps)
   - Text content readable over animation
3. Resize window - animation should resize properly
4. Navigate away from login - animation should stop (no memory leak)
</verification>

<success_criteria>
- Mobile layout uses design tokens throughout
- Sidebar overlay has terminal styling (green border, black bg)
- Matrix background animation renders on login page
- Animation is performant (no visible lag or jank)
- Animation is subtle (low opacity, doesn't distract)
- Existing E2E tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/06.2-restyle-app-with-pencil-design/06.2-04-SUMMARY.md`
</output>
