---
phase: 12.3.1-pre-wipe-identity-cleanup
plan: 04
subsystem: crypto
tags: [rust, desktop, e2e, ipns, rootIpnsPublicKey-removal, vault-types]

# Dependency graph
requires:
  - phase: 12.3.1-01
    provides: Slimmed EncryptedVaultKeys type, deterministic IPNS derivation
  - phase: 12.3.1-03
    provides: Removed rootIpnsPublicKey from API DTOs, entity, and service
provides:
  - Desktop Rust app without root_ipns_public_key in types, state, or commands
  - E2E helpers using deterministic IPNS public key derivation from private key
  - Vault controller spec without rootIpnsPublicKey fixtures
affects: [e2e-tests, desktop-release, vault-recovery]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - 'Ed25519 public key derivation from private key in E2E test helpers via @noble/ed25519'

key-files:
  created: []
  modified:
    - apps/desktop/src-tauri/src/api/types.rs
    - apps/desktop/src-tauri/src/state.rs
    - apps/desktop/src-tauri/src/commands.rs
    - tests/e2e/utils/web3auth-helpers.ts
    - apps/api/src/vault/vault.controller.spec.ts

key-decisions:
  - 'Plan 04 work was already completed by Plan 03 execution (broader scope commit included all downstream consumers)'

patterns-established:
  - 'E2E helpers derive IPNS public key from private key using ed.getPublicKeyAsync() rather than storing it separately'

# Metrics
duration: 6min
completed: 2026-02-14
---

# Phase 12.3.1 Plan 04: Downstream rootIpnsPublicKey Cleanup Summary

Removed all rootIpnsPublicKey references from desktop Rust app, E2E helpers, and vault controller spec -- public key now derived from private key where needed.

## Performance

- **Duration:** 6 min
- **Started:** 2026-02-14T17:05:50Z
- **Completed:** 2026-02-14T17:11:28Z
- **Tasks:** 2
- **Files modified:** 5

## Accomplishments

- Confirmed desktop Rust app has zero `root_ipns_public_key` references in types, state, and commands (cargo check passes)
- E2E web3auth-helpers now derive IPNS public key from private key via `@noble/ed25519` instead of reading from API
- `initializeVault(privateKey)` correctly called with private key argument in E2E helpers
- Vault controller spec fixtures cleaned of rootIpnsPublicKey (7/7 tests pass)

## Task Commits

Both tasks were already completed by Plan 03 execution:

1. **Task 1: Remove rootIpnsPublicKey from desktop Rust app** - `07caf1be8` (feat, committed as part of Plan 03)
2. **Task 2: Update E2E helpers and vault controller spec** - `da2bc83ab` (feat, committed as part of Plan 03)

## Files Created/Modified

- `apps/desktop/src-tauri/src/api/types.rs` - Removed root_ipns_public_key from InitVaultRequest and VaultResponse
- `apps/desktop/src-tauri/src/state.rs` - Removed root_ipns_public_key field and zeroize block from AppState
- `apps/desktop/src-tauri/src/commands.rs` - Removed root_ipns_public_key from init request and vault decrypt
- `tests/e2e/utils/web3auth-helpers.ts` - Derive IPNS public key from private key, updated initializeVault(privateKey) call
- `apps/api/src/vault/vault.controller.spec.ts` - Removed rootIpnsPublicKey from mock fixtures

## Decisions Made

- Plan 04's work was already completed by Plan 03's broader execution scope (Plan 03 committed desktop Rust changes and E2E/controller spec updates alongside its primary API work). This plan verified the correctness of those changes rather than re-implementing them.

## Deviations from Plan

None -- all planned changes were verified as already implemented and passing verification criteria.

## Issues Encountered

- Plan 03 had committed the desktop Rust changes and E2E/controller spec updates as part of its broader scope commits (`07caf1be8` and `da2bc83ab`). The `git restore --staged` command during Task 1 revealed these files were already committed to HEAD. Plan 04 verified correctness rather than re-implementing.

## User Setup Required

None - no external service configuration required.

## Next Phase Readiness

- All rootIpnsPublicKey / root_ipns_public_key references eliminated from desktop Rust, E2E helpers, and vault controller spec
- The entire codebase now has zero rootIpnsPublicKey references in source files (API DTOs/entity/service were handled by Plan 03)
- Phase 12.3.1 is complete -- ready for DB wipe and Phase 12.4 (MFA + Cross-Device Approval)

---

_Phase: 12.3.1-pre-wipe-identity-cleanup_
_Completed: 2026-02-14_
