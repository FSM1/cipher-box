# Codebase Structure

**Analysis Date:** 2026-01-19

## Directory Layout

```
/Users/myankelev/Code/random/cipher-box/
├── Documentation/           # Versioned specification documents
├── poc/                     # Proof-of-concept console harness
├── .claude/                 # Claude agent configuration (GSD commands)
├── .github/                 # GitHub configuration
├── .planning/               # GSD planning artifacts
├── .vscode/                 # VSCode workspace settings
├── 00_START_HERE.md         # Project entry point and overview
├── README.md                # Technology stack and architecture summary
├── LICENSE                  # MIT license
└── cipherbox logo.png       # Project logo
```

## Directory Purposes

**Documentation:**
- Purpose: Complete versioned specification for CipherBox v1.0 implementation
- Contains: Markdown documents with YAML frontmatter (version, last_updated, status, ai_context)
- Key files: `PRD.md`, `TECHNICAL_ARCHITECTURE.md`, `API_SPECIFICATION.md`, `CLIENT_SPECIFICATION.md`, `DATA_FLOWS.md`, `IMPLEMENTATION_ROADMAP.md`
- Version: 1.9.0+ (minor bump for new sections, patch bump for updates)
- Update Rule: When modifying any doc, increment version in frontmatter and update `last_updated` field

**poc:**
- Purpose: Single-user console harness validating IPFS/IPNS and encryption flows without full backend/frontend
- Contains: TypeScript source, build artifacts, configuration, scripts, state persistence
- Subdirectories: `src/` (harness code), `scripts/` (utilities), `dist/` (compiled output), `state/` (JSON state export), `node_modules/` (dependencies)
- Entry: `src/index.ts` (single 725-line file with all harness logic)
- Run: `npm start` (executes harness via tsx)

**.claude:**
- Purpose: Claude Code agent configuration and GSD (Get Shit Done) command setup
- Contains: Agent definitions, command hooks, templates, settings
- Subdirectories: `agents/`, `commands/`, `get-shit-done/`, `hooks/`
- Not committed: Agent/command files are generated/user-specific

**.github:**
- Purpose: GitHub repository configuration
- Contains: Copilot instructions
- Key files: `copilot-instructions.md`

**.planning:**
- Purpose: GSD planning artifacts (codebase analysis, phase plans)
- Contains: `codebase/` subdirectory for ARCHITECTURE.md, STRUCTURE.md, etc.
- Generated by: `/gsd:map-codebase` command
- Not committed: Planning artifacts are session-specific

**.vscode:**
- Purpose: VSCode workspace settings
- Contains: `extensions.json` (recommended extensions)

## Key File Locations

**Entry Points:**
- `00_START_HERE.md`: Human-readable project overview (links to all documentation)
- `README.md`: Tech stack summary, architecture diagram, user journey example
- `poc/src/index.ts`: PoC harness entry point (main function at line 548)

**Configuration:**
- `poc/package.json`: PoC dependencies and scripts
- `poc/tsconfig.json`: TypeScript compiler configuration (ES2022, strict mode, bundler resolution)
- `poc/.env`: Environment variables (ECDSA_PRIVATE_KEY, IPFS_API_URL, Pinata keys, poll settings, stress test config)
- `poc/.env.example`: Template for environment configuration
- `.claude/settings.json`: Claude agent global settings
- `.vscode/extensions.json`: VSCode recommended extensions

**Core Logic:**
- `poc/src/index.ts`: All PoC harness logic (encryption, IPFS/IPNS operations, state management, teardown)
- `poc/scripts/gen-private-key.ts`: ECDSA private key generator (32-byte hex output)

**Documentation:**
- `Documentation/PRD.md`: Product requirements, user personas, user journeys, scope, success criteria
- `Documentation/TECHNICAL_ARCHITECTURE.md`: Encryption specs, key hierarchy, auth flows, system design, threat model
- `Documentation/API_SPECIFICATION.md`: Backend endpoint contracts, database schema, request/response formats
- `Documentation/CLIENT_SPECIFICATION.md`: Web UI and desktop app specifications
- `Documentation/DATA_FLOWS.md`: Sequence diagrams, test vectors, cryptographic examples
- `Documentation/IMPLEMENTATION_ROADMAP.md`: 12-week development timeline with phases, deliverables, acceptance criteria

**State Persistence:**
- `poc/state/state.json`: Exported vault state (rootIpnsName, rootIpnsKeyName, rootFolderKey in hex, updatedAt timestamp)

**Build Artifacts:**
- `poc/dist/index.js`: Compiled JavaScript output (generated by `npm run build`)

## Naming Conventions

**Files:**
- Documentation: UPPERCASE.md with versioned frontmatter (e.g., `PRD.md`, `API_SPECIFICATION.md`)
- Entry points: lowercase with descriptive names (e.g., `00_START_HERE.md`, `index.ts`)
- Scripts: kebab-case with `.ts` extension (e.g., `gen-private-key.ts`)
- Config: lowercase with extension (e.g., `package.json`, `tsconfig.json`, `.env`)

**Directories:**
- Top-level: PascalCase for documentation (`Documentation/`), lowercase for code/config (`poc/`, `.claude/`)
- Nested: lowercase (e.g., `poc/src/`, `poc/scripts/`, `poc/state/`)

**Variables (TypeScript):**
- camelCase: `privateKey`, `ipnsName`, `folderKey`, `fileEntry`, `rootFolder`
- Types: PascalCase (`FolderState`, `FileEntry`, `FolderMetadata`, `HarnessContext`)
- Constants: SCREAMING_SNAKE_CASE (`TAG_SIZE`, `IV_SIZE`)

**Functions:**
- camelCase: `aesGcmEncrypt`, `publishFolderMetadata`, `resolveIpnsToCid`, `buildFolderTree`
- Descriptive action verbs: `encrypt`, `decrypt`, `generate`, `fetch`, `download`, `verify`, `pin`, `unpin`

## Where to Add New Code

**New PoC Feature (e.g., additional crypto operation):**
- Primary code: `poc/src/index.ts` (add utility function near related crypto functions, lines 113-169)
- Tests: Not currently implemented (harness is self-verifying via content comparison)

**New Script (e.g., state import tool):**
- Implementation: `poc/scripts/<script-name>.ts`
- Registration: Add npm script to `poc/package.json` scripts section

**New Documentation Section:**
- Implementation: Add to relevant `Documentation/*.md` file
- Version bump: Increment version in frontmatter, update `last_updated`, update `.claude/CLAUDE.md` "Current Version"

**Backend Implementation (Not Yet Started):**
- Primary code: Create `backend/src/` with NestJS modules structure
- Tests: `backend/test/` with Jest test files
- Config: `backend/package.json`, `backend/tsconfig.json`, `backend/.env`

**Frontend Implementation (Not Yet Started):**
- Primary code: Create `frontend/src/` with React components structure
- Tests: `frontend/src/__tests__/` with component test files
- Config: `frontend/package.json`, `frontend/tsconfig.json`, `frontend/.env`

**Desktop App Implementation (Not Yet Started):**
- Primary code: Create `desktop/src/` with Tauri/Electron main process and FUSE mount logic
- Tests: `desktop/test/` with integration tests
- Config: `desktop/package.json`, `desktop/tauri.conf.json` (or Electron equivalent)

**Utilities (Shared Helpers):**
- Crypto utilities: Add to `poc/src/index.ts` crypto section (or extract to `poc/src/crypto.ts` if file grows)
- IPFS utilities: Add to `poc/src/index.ts` IPFS section (or extract to `poc/src/ipfs.ts`)
- Type definitions: Currently inline in `poc/src/index.ts` (lines 12-69); extract to `poc/src/types.ts` if shared across multiple files

## Special Directories

**poc/node_modules:**
- Purpose: npm dependencies for PoC harness
- Generated: Yes (by `npm install`)
- Committed: No (in `.gitignore`)

**poc/dist:**
- Purpose: TypeScript compilation output
- Generated: Yes (by `npm run build`)
- Committed: No (in `.gitignore`)

**poc/state:**
- Purpose: Optional JSON export of vault state for harness verification
- Generated: Yes (by harness at runtime if `POC_STATE_DIR` env var set)
- Committed: No (contains cryptographic keys)

**.claude/agents:**
- Purpose: Claude Code agent definitions
- Generated: Yes (by GSD command initialization)
- Committed: No (untracked files in git status)

**.claude/commands:**
- Purpose: Claude Code custom command definitions
- Generated: Yes (by GSD command setup)
- Committed: No (untracked files in git status)

**.planning/codebase:**
- Purpose: Codebase analysis documents for GSD planning
- Generated: Yes (by `/gsd:map-codebase` command)
- Committed: No (session-specific artifacts)

## File Path Reference Patterns

**Absolute paths used in this codebase:**
- `/Users/myankelev/Code/random/cipher-box/` - Project root
- `/Users/myankelev/Code/random/cipher-box/Documentation/` - Specifications
- `/Users/myankelev/Code/random/cipher-box/poc/` - PoC harness root
- `/Users/myankelev/Code/random/cipher-box/poc/src/index.ts` - Harness entry point
- `/Users/myankelev/Code/random/cipher-box/poc/scripts/gen-private-key.ts` - Key generator
- `/Users/myankelev/Code/random/cipher-box/.planning/codebase/` - GSD analysis artifacts

**Relative imports (within PoC):**
- Not currently needed (single-file harness)
- Future pattern: `import { aesGcmEncrypt } from './crypto'` for extracted utilities

---

*Structure analysis: 2026-01-19*
